<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="MicroMoB">
<title>Beverton-Holt aquatic model • MicroMoB</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Beverton-Holt aquatic model">
<meta property="og:description" content="MicroMoB">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MicroMoB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/MicroMoB.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/bloodmeal.html">Blood feeding</a>
    <a class="dropdown-item" href="../articles/RM_mosquito.html">Ross-Macdonald mosquito model</a>
    <a class="dropdown-item" href="../articles/BQ_mosquito.html">Simple behavioral state mosquito model</a>
    <a class="dropdown-item" href="../articles/MOI_human.html">Queueing model for human superinfection</a>
    <a class="dropdown-item" href="../articles/BH_aqua.html">Beverton-Holt aquatic model</a>
    <a class="dropdown-item" href="../articles/RM_transmission.html">Ross-Macdonald transmission model</a>
    <a class="dropdown-item" href="../articles/Advanced.html">Advanced topics</a>
    <a class="dropdown-item" href="../articles/Contributing.html">Contributing</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dd-harp/MicroMoB/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Beverton-Holt aquatic model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dd-harp/MicroMoB/blob/HEAD/vignettes/BH_aqua.Rmd" class="external-link"><code>vignettes/BH_aqua.Rmd</code></a></small>
      <div class="d-none name"><code>BH_aqua.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dd-harp.github.io/MicroMoB/">MicroMoB</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span></code></pre></div>
<p>The simplest non-trivial model of aquatic mosquito dynamics which
exhibits density-dependence (negative feedback) is a Beverton-Holt (BH)
style model. It is a kind of discrete logistic equation. We have
implemented a BH model that conforms to the aquatic (immature) component
interface to be used with other mosquito models fulfilling the adult
component interface.</p>
<p>The model groups all immature mosquito stages into a single
compartment <code>L</code>. Each time step some number may mature and be
ready to emerge as adults, <code>A</code>. The model requires 3
(potentially time and patch varying parameters), <code>K</code>, which
determines the strength of density dependent mortality,
<code>surv</code>, the baseline daily survival probability, and
<code>molt</code>, the daily proportion of immature mosquitoes which
mature and emerge as adults.</p>
<div class="section level2">
<h2 id="deterministic-model">Deterministic model<a class="anchor" aria-label="anchor" href="#deterministic-model"></a>
</h2>
<p>The state updating equation is as follows:</p>
<p><span class="math display">\[\begin{equation}
L_{t+1} = eggs + (1-molt) \cdot surv \cdot L_{t} \cdot \left(
\frac{K}{L_{t}+K} \right) \\
A_{t} = molt \cdot surv \cdot L_{t} \cdot \left( \frac{K}{L_{t}+K}
\right)
\end{equation}\]</span></p>
</div>
<div class="section level2">
<h2 id="stochastic-model">Stochastic model<a class="anchor" aria-label="anchor" href="#stochastic-model"></a>
</h2>
<p>In the stochastic model on a time step, we first draw the number of
survivors:</p>
<p><span class="math display">\[\begin{equation}
survivors \sim \mathrm{binomial}(L, surv \cdot \left( \frac{K}{L_{t}+K}
\right) )
\end{equation}\]</span></p>
<p>The number who emerge is also a binomial random variate:</p>
<p><span class="math display">\[\begin{equation}
emerge \sim \mathrm{binomial}(survivors, molt)
\end{equation}\]</span></p>
<p>Then state is updated:</p>
<p><span class="math display">\[\begin{equation}
L_{t+1} = eggs + survivors - emerge \\
A_{t} = emerge
\end{equation}\]</span></p>
</div>
<div class="section level2">
<h2 id="deterministic-equilibrium">Deterministic equilibrium<a class="anchor" aria-label="anchor" href="#deterministic-equilibrium"></a>
</h2>
<p>Despite being a nonlinear equation, we can solve the equilibrium. We
assume that <code>eggs</code> is known, and that the desired daily
emergence is known (<code>lambda</code>, or <code>A</code> in the BH
model’s notation). Then we solve for <code>K</code> and
<code>L</code>:</p>
<p><span class="math display">\[\begin{equation}
L = \lambda \left( \frac{1}{molt} - 1 \right) + eggs \\
K = \frac{-\lambda L}{\lambda - L \cdot molt \cdot surv}
\end{equation}\]</span></p>
<p>We can set up a simulation using the RM mosquito model to check that
everything is at equilibrium. First we calculate the equilibrium values.
We do not use any components other than the aquatic and adult mosquito
components.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">patches</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">tmax</span> <span class="op">&lt;-</span> <span class="fl">1e2</span></span>
<span></span>
<span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fl">120</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">0.9</span></span>
<span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="va">M</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">p</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nu</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fl">0.3</span></span>
<span><span class="va">eggs</span> <span class="op">&lt;-</span> <span class="va">nu</span> <span class="op">*</span> <span class="va">f</span> <span class="op">*</span> <span class="va">M</span></span>
<span></span>
<span><span class="co"># static pars</span></span>
<span><span class="va">molt</span> <span class="op">&lt;-</span>  <span class="fl">0.1</span></span>
<span><span class="va">surv</span> <span class="op">&lt;-</span> <span class="fl">0.9</span></span>
<span></span>
<span><span class="co"># solve L</span></span>
<span><span class="va">L</span> <span class="op">&lt;-</span> <span class="va">lambda</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">molt</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="va">eggs</span></span>
<span><span class="va">K</span> <span class="op">&lt;-</span> <span class="op">-</span> <span class="op">(</span><span class="va">lambda</span> <span class="op">*</span> <span class="va">L</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">lambda</span> <span class="op">-</span> <span class="va">L</span><span class="op">*</span><span class="va">molt</span><span class="op">*</span><span class="va">surv</span><span class="op">)</span></span></code></pre></div>
<p>Let’s set up the model. We use <code><a href="../reference/make_MicroMoB.html">make_MicroMoB()</a></code> to set up
the base model object, and <code><a href="../reference/setup_aqua_BH.html">setup_aqua_BH()</a></code> for the
Beverton-Holt aquatic model with our chosen parameters.
<code><a href="../reference/setup_mosquito_RM.html">setup_mosquito_RM()</a></code> will set up a Ross-Macdonald model of
adult mosquito dynamics.</p>
<p>We run a deterministic simulation and store output in a matrix.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># deterministic run</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_MicroMoB.html">make_MicroMoB</a></span><span class="op">(</span>tmax <span class="op">=</span> <span class="va">tmax</span>, p <span class="op">=</span> <span class="va">patches</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/setup_aqua_BH.html">setup_aqua_BH</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span>, stochastic <span class="op">=</span> <span class="cn">FALSE</span>, molt <span class="op">=</span> <span class="va">molt</span>, surv <span class="op">=</span> <span class="va">surv</span>, K <span class="op">=</span> <span class="va">K</span>, L <span class="op">=</span> <span class="va">L</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/setup_mosquito_RM.html">setup_mosquito_RM</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span>, stochastic <span class="op">=</span> <span class="cn">FALSE</span>, f <span class="op">=</span> <span class="va">f</span>, q <span class="op">=</span> <span class="fl">0.9</span>, eip <span class="op">=</span> <span class="fl">10</span>, p <span class="op">=</span> <span class="va">p</span>, psi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, nu <span class="op">=</span> <span class="va">nu</span>, M <span class="op">=</span> <span class="va">M</span>, Y <span class="op">=</span> <span class="fl">0</span>, Z <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out_det</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/J.html" class="external-link">CJ</a></span><span class="op">(</span>day <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">tmax</span>, state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'L'</span>, <span class="st">'A'</span>, <span class="st">'M'</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">NaN</span><span class="op">)</span></span>
<span><span class="va">out_det</span> <span class="op">&lt;-</span> <span class="va">out_det</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'L'</span>, <span class="st">'A'</span>, <span class="st">'M'</span><span class="op">)</span>, on<span class="op">=</span><span class="st">"state"</span><span class="op">]</span></span>
<span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkey</a></span><span class="op">(</span><span class="va">out_det</span>, <span class="va">day</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">while</span> <span class="op">(</span><span class="fu"><a href="../reference/get_tnow.html">get_tnow</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">tmax</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/step_aqua.html">step_aqua</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/step_mosquitoes.html">step_mosquitoes</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">out_det</span><span class="op">[</span><span class="va">day</span> <span class="op">==</span> <span class="fu"><a href="../reference/get_tnow.html">get_tnow</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">state</span> <span class="op">==</span> <span class="st">'L'</span>, <span class="va">value</span> <span class="op">:=</span> <span class="va">mod</span><span class="op">$</span><span class="va">aqua</span><span class="op">$</span><span class="va">L</span><span class="op">]</span></span>
<span>  <span class="va">out_det</span><span class="op">[</span><span class="va">day</span> <span class="op">==</span> <span class="fu"><a href="../reference/get_tnow.html">get_tnow</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">state</span> <span class="op">==</span> <span class="st">'A'</span>, <span class="va">value</span> <span class="op">:=</span> <span class="va">mod</span><span class="op">$</span><span class="va">aqua</span><span class="op">$</span><span class="va">A</span><span class="op">]</span></span>
<span>  <span class="va">out_det</span><span class="op">[</span><span class="va">day</span> <span class="op">==</span> <span class="fu"><a href="../reference/get_tnow.html">get_tnow</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">state</span> <span class="op">==</span> <span class="st">'M'</span>, <span class="va">value</span> <span class="op">:=</span> <span class="va">mod</span><span class="op">$</span><span class="va">mosquito</span><span class="op">$</span><span class="va">M</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">mod</span><span class="op">$</span><span class="va">global</span><span class="op">$</span><span class="va">tnow</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="va">global</span><span class="op">$</span><span class="va">tnow</span> <span class="op">+</span> <span class="fl">1L</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now we run the same model, but using the option
<code>stochastic = TRUE</code> for our dynamics, and draw 10
trajectories.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># stochastic runs</span></span>
<span><span class="va">out_sto</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">mclapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">runid</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_MicroMoB.html">make_MicroMoB</a></span><span class="op">(</span>tmax <span class="op">=</span> <span class="va">tmax</span>, p <span class="op">=</span> <span class="va">patches</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/setup_aqua_BH.html">setup_aqua_BH</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span>, stochastic <span class="op">=</span> <span class="cn">TRUE</span>, molt <span class="op">=</span> <span class="va">molt</span>, surv <span class="op">=</span> <span class="va">surv</span>, K <span class="op">=</span> <span class="va">K</span>, L <span class="op">=</span> <span class="va">L</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/setup_mosquito_RM.html">setup_mosquito_RM</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span>, stochastic <span class="op">=</span> <span class="cn">TRUE</span>, f <span class="op">=</span> <span class="va">f</span>, q <span class="op">=</span> <span class="fl">0.9</span>, eip <span class="op">=</span> <span class="fl">10</span>, p <span class="op">=</span> <span class="va">p</span>, psi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, nu <span class="op">=</span> <span class="va">nu</span>, M <span class="op">=</span> <span class="va">M</span>, Y <span class="op">=</span> <span class="fl">0</span>, Z <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/J.html" class="external-link">CJ</a></span><span class="op">(</span>day <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">tmax</span>, state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'L'</span>, <span class="st">'A'</span>, <span class="st">'M'</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">NaN</span><span class="op">)</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'L'</span>, <span class="st">'A'</span>, <span class="st">'M'</span><span class="op">)</span>, on<span class="op">=</span><span class="st">"state"</span><span class="op">]</span></span>
<span>  <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkey</a></span><span class="op">(</span><span class="va">out</span>, <span class="va">day</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">while</span> <span class="op">(</span><span class="fu"><a href="../reference/get_tnow.html">get_tnow</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">tmax</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="fu"><a href="../reference/step_aqua.html">step_aqua</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/step_mosquitoes.html">step_mosquitoes</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">out</span><span class="op">[</span><span class="va">day</span> <span class="op">==</span> <span class="fu"><a href="../reference/get_tnow.html">get_tnow</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">state</span> <span class="op">==</span> <span class="st">'L'</span>, <span class="va">value</span> <span class="op">:=</span> <span class="va">mod</span><span class="op">$</span><span class="va">aqua</span><span class="op">$</span><span class="va">L</span><span class="op">]</span></span>
<span>    <span class="va">out</span><span class="op">[</span><span class="va">day</span> <span class="op">==</span> <span class="fu"><a href="../reference/get_tnow.html">get_tnow</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">state</span> <span class="op">==</span> <span class="st">'A'</span>, <span class="va">value</span> <span class="op">:=</span> <span class="va">mod</span><span class="op">$</span><span class="va">aqua</span><span class="op">$</span><span class="va">A</span><span class="op">]</span></span>
<span>    <span class="va">out</span><span class="op">[</span><span class="va">day</span> <span class="op">==</span> <span class="fu"><a href="../reference/get_tnow.html">get_tnow</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">state</span> <span class="op">==</span> <span class="st">'M'</span>, <span class="va">value</span> <span class="op">:=</span> <span class="va">mod</span><span class="op">$</span><span class="va">mosquito</span><span class="op">$</span><span class="va">M</span><span class="op">]</span></span>
<span>  </span>
<span>    <span class="va">mod</span><span class="op">$</span><span class="va">global</span><span class="op">$</span><span class="va">tnow</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="va">global</span><span class="op">$</span><span class="va">tnow</span> <span class="op">+</span> <span class="fl">1L</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">out</span><span class="op">[</span>, <span class="st">'run'</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">runid</span><span class="op">)</span><span class="op">]</span> </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out_sto</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="va">out_sto</span><span class="op">)</span></span></code></pre></div>
<p>Now we process the output and plot the results. Deterministic
solutions are solid lines and each stochastic trajectory is a faint
line.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">out_sto</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">day</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">state</span>, group <span class="op">=</span> <span class="va">run</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.35</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">out_det</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">day</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">state</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">state</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span></code></pre></div>
<p><img src="BH_aqua_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Sean L. Wu, David L. Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
