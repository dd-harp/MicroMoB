<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Micro-MoB • MicroMoB</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Micro-MoB">
<meta property="og:description" content="MicroMoB">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MicroMoB</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Micro-MoB.html">Micro-MoB</a>
    </li>
    <li>
      <a href="../articles/key-themes.html">key-themes</a>
    </li>
    <li>
      <a href="../articles/math.html">math</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dd-harp/MicroMoB/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Micro-MoB_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Micro-MoB</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dd-harp/MicroMoB/blob/master/vignettes/Micro-MoB.Rmd"><code>vignettes/Micro-MoB.Rmd</code></a></small>
      <div class="hidden name"><code>Micro-MoB.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dd-harp/MicroMoB">MicroMoB</a></span><span class="op">)</span></code></pre></div>
<div id="a-framework" class="section level1">
<h1 class="hasAnchor">
<a href="#a-framework" class="anchor"></a>A Framework</h1>
<div id="intro" class="section level2">
<h2 class="hasAnchor">
<a href="#intro" class="anchor"></a>0. Intro</h2>
<p>This document describes a software package to build and run <strong>microsimulation</strong> models of mosquito-borne pathogens, called <strong>Micro-MoB</strong> (<strong>Micro</strong>simulation - <strong>Mo</strong>squito <strong>B</strong>orne).</p>
<p><strong>NOTE</strong> If you are viewing this document as <code>MicroMoB.html</code> in a web browser, you should see a set of nested tabs that will help you navigate this document. If you don’t see the tabs, or if equations are rendered poorly, or if images are missing, please do the following:</p>
<ol style="list-style-type: decimal">
<li><p>Save the file <code>MicroMoB.html</code> to a location on your desktop.</p></li>
<li><p>Open <code>MicroMoB.html</code> from your web browser.</p></li>
<li><p>If that doesn’t fix the problems, please make a note of your configuration and send a note to David L Smith (<a href="mailto:smitdave@uw.edu" class="email">smitdave@uw.edu</a>) or (if it’s active) send mail by clicking on <a href="mailto:smitdave@uw.edu">David L Smith</a></p></li>
</ol>
</div>
<div id="intro-1" class="section level2">
<h2 class="hasAnchor">
<a href="#intro-1" class="anchor"></a>1. Intro</h2>
<div id="why-micro-mob" class="section level3">
<h3 class="hasAnchor">
<a href="#why-micro-mob" class="anchor"></a>1.1 Why <strong>Micro-MoB</strong>?</h3>
<p>There are already several software packages out there, but I wanted a package that was modular and flexible.</p>
<ul>
<li><p>Modularity</p></li>
<li><p>Flexibility</p></li>
<li><p>Scalability</p></li>
<li><p>Spatially explicit, localized effects</p></li>
</ul>
</div>
<div id="modularity" class="section level3">
<h3 class="hasAnchor">
<a href="#modularity" class="anchor"></a>1.2 Modularity</h3>
<p><strong>Micro-MoB</strong> has a modular design. In the following, I introduce one version of the Ross-Macdonald model, then take it apart, modularize it, and re-assemble it as a generalized set equations that are very modular.</p>
<div id="section" class="section level4">
<h4 class="hasAnchor">
<a href="#section" class="anchor"></a>1.2.1</h4>
<p>Mosquito-transmitted pathogen models are naturally modular. The simple models developed by Ross and Macdonald have given way, over time, to a very complicated set of concepts.</p>
<div class="figure" style="text-align: center">
<img src="ElaboratedRM.png" alt="The modular design of Micro-MoB." width="100%"><p class="caption">
The modular design of Micro-MoB.
</p>
</div>
</div>
<div id="ross-macdonald" class="section level4">
<h4 class="hasAnchor">
<a href="#ross-macdonald" class="anchor"></a>1.2.2 Ross-Macdonald</h4>
<div id="transmission-dynamics" class="section level5">
<h5 class="hasAnchor">
<a href="#transmission-dynamics" class="anchor"></a>1.2.2.1 Transmission Dynamics</h5>
<hr>
<div class="figure" style="text-align: center">
<img src="RossMacdonald.png" alt="A graphical representation of the Ross-Macdonald Model, from Smith DL, *et al.* (2014). For a longer introduction to the Ross-Macdonald model, see Smith DL, *et al.* (2012)." width="100%"><p class="caption">
A graphical representation of the Ross-Macdonald Model, from Smith DL, <em>et al.</em> (2014). For a longer introduction to the Ross-Macdonald model, see Smith DL, <em>et al.</em> (2012).
</p>
</div>
<hr>
<p>The Ross-Macdonald model looks like this (Figure 2). It’s a comparatively simple mathematical model that was formulated by Ronald Ross in 1911 as a system of coupled ordinary differential equations. The parameter names and the modern understanding is due largely to Macdonald from a set of papers published over the years 1950-1955.</p>
<hr>
<div class="figure" style="text-align: center">
<img src="Ross-Macdonald.png" alt="A graphical representation of the Ross-Macdonald model in Micro-MoB." width="100%"><p class="caption">
A graphical representation of the Ross-Macdonald model in Micro-MoB.
</p>
</div>
<hr>
<p>In Micro-MoB, we’ve abstracted and expanded on the model to make it modular and easy to extend. To motivate why and how, I will rewrite one version of the Ross-Macdonald model.</p>
<hr>
<p><strong>References</strong></p>
<ul>
<li><p>Smith, D. L., Perkins, T. A., Reiner, R. C., Jr, Barker, C. M., Niu, T., Chaves, L. F., Ellis, A. M., George, D. B., Le Menach, A., Pulliam, J. R. C., Bisanzio, D., Buckee, C., Chiyaka, C., Cummings, D. A. T., Garcia, A. J., Gatton, M. L., Gething, P. W., Hartley, D. M., Johnston, G., … Scott, T. W. (2014). Recasting the theory of mosquito-borne pathogen transmission dynamics and control. Transactions of the Royal Society of Tropical Medicine and Hygiene, 108(4), 185–197.</p></li>
<li><p>Smith, D. L., Battle, K. E., Hay, S. I., Barker, C. M., Scott, T. W., &amp; McKenzie, F. E. (2012). Ross, Macdonald, and a theory for the dynamics and control of mosquito-transmitted pathogens. PLoS Pathogens, 8(4), e1002588.</p></li>
</ul>
</div>
<div id="a-ross-macdonald-style-model" class="section level5">
<h5 class="hasAnchor">
<a href="#a-ross-macdonald-style-model" class="anchor"></a>1.2.2.1 A Ross-Macdonald-style Model</h5>
<p>This is one version of the Ross-Macdonald model can be written in the following way as a set of variables, parameters, and equations. I’ve written it as a set of coupled delay differential equations where <span class="math inline">\(Y_\tau\)</span> is interpreted as <span class="math inline">\(Y(t-\tau)\)</span>.</p>
<p><strong>Variables</strong></p>
<ul>
<li><p><span class="math inline">\(M\)</span> :: Mosquito Population Density</p></li>
<li><p><span class="math inline">\(Y\)</span> :: Infected Mosquitoes</p></li>
<li><p><span class="math inline">\(Z\)</span> :: Infective mosquitoes</p></li>
<li><p><span class="math inline">\(H\)</span> :: Human Population Density</p></li>
<li><p><span class="math inline">\(P\)</span> :: Density of Infected and Infective Humans</p></li>
</ul>
<p><strong>Parameters</strong></p>
<ul>
<li><p><span class="math inline">\(\Lambda\)</span> :: The emergence rate of adult, female mosquitoes</p></li>
<li><p><span class="math inline">\(\tau\)</span> :: The extrinsic incubation period (EIP)</p></li>
<li><p><span class="math inline">\(g\)</span> :: The per-capita daily mosquito death rate</p></li>
<li><p><span class="math inline">\(f\)</span> :: The per-capita daily mosquito blood feeding rate</p></li>
<li><p><span class="math inline">\(Q\)</span> :: The proportion of bloodmeals taken on a human</p></li>
<li><p><span class="math inline">\(b\)</span> :: The proportion of infective bites that infect a human</p></li>
<li><p><span class="math inline">\(c\)</span> :: The proportion of bites on infective humans that infect a mosquito</p></li>
</ul>
<p><strong>Equations</strong> <span class="math display">\[\begin{equation}
\begin{array}{rl}
\frac{dM}{dt}&amp;= \Lambda - g M \\ 
\frac{dY}{dt}&amp;= fQc\frac{P}{H}(M-Y) - g Y \\ 
\frac{dZ}{dt}&amp;= fQc\frac{P_\tau}{H_\tau}(M_\tau-Y_\tau) e^{-g\tau} - g Z \\ 
\frac{dP}{dt}&amp;= bfQ\frac{Z}{H}(H-P) - r P \\ 
\end{array}
\end{equation}\]</span></p>
</div>
<div id="decoupling" class="section level5">
<h5 class="hasAnchor">
<a href="#decoupling" class="anchor"></a>1.1.2.2. Decoupling</h5>
<p>With a couple of simplifications, I’ve rewritten the equations from 1.2.2.1 as a set of 3 coupled ODEs.</p>
<p><span class="math display">\[\begin{equation}
\begin{array}{rl|rl}
\frac{dM}{dt}&amp;= \Lambda - g M  \\ 
\frac{dY}{dt}&amp;= fQ\kappa (M-Y) - g Y &amp; \kappa &amp;= c\frac{P}{H}\\ 
\frac{dP}{dt}&amp;= bE (H-P) - r P &amp; E &amp;= fQ\frac{Y_\tau}{H} e^{-g\tau} \\ 
\end{array}
\end{equation}\]</span></p>
</div>
</div>
<div id="mosquito-population-dynamics" class="section level4">
<h4 class="hasAnchor">
<a href="#mosquito-population-dynamics" class="anchor"></a>1.2.3 Mosquito Population Dynamics</h4>
<p>Now, I want to extend the Ross-Macdonald model to consider mosquito population dynamics.</p>
<hr>
<div class="figure" style="text-align: center">
<img src="MosquitoEcology.png" alt="The population dynamics of mosquitoes in a diagram." width="100%"><p class="caption">
The population dynamics of mosquitoes in a diagram.
</p>
</div>
<hr>
<p>Instead of passing adult mosquito emergence rates, <span class="math inline">\(\Lambda\)</span>, to the model as a trace function, I will instead let <span class="math inline">\(\Lambda\)</span> be a term that is passed from a new equation.</p>
<p><strong>Variables</strong></p>
<ul>
<li>
<span class="math inline">\(L\)</span> is the population density of immature mosquitoes in an aquatic habitat.</li>
</ul>
<p><strong>Parameters</strong></p>
<ul>
<li><p><span class="math inline">\(\nu\)</span> is the number of female eggs laid, per blood meal</p></li>
<li><p><span class="math inline">\(\theta\)</span> is the development rate of immature mosquitoes</p></li>
<li><p><span class="math inline">\(\gamma\)</span> is the death rate of immature mosquitoes</p></li>
<li><p><span class="math inline">\(\sigma L\)</span> is the response to crowding, the increase in the per-capita death rate as a function of the density of immature mosquitoes</p></li>
</ul>
<p><strong>Terms</strong></p>
<ul>
<li><p>Let <span class="math inline">\(G = f\nu M\)</span> denote the number of eggs laid.</p></li>
<li><p>Let <span class="math inline">\(\Lambda = \theta L\)</span> be the rate of emergence of adult mosquitoes.</p></li>
</ul>
<p><strong>Equations</strong></p>
<p><span class="math display">\[\begin{equation}
\begin{array}{rl|rl}
\frac{dL}{dt} &amp;= G - (\theta + \gamma + \sigma L) L &amp; G &amp;= v\nu M\\ 
\frac{dM}{dt} &amp;= \Lambda - g M &amp; \Lambda &amp;= \theta L \\
\end{array}
\end{equation}\]</span></p>
<p><strong>Refs</strong></p>
<p>Brady, O. J., Godfray, H. C. J., Tatem, A. J., Gething, P. W., Cohen, J. M., McKenzie, F. E., Alex Perkins, T., Reiner, R. C., Jr, Tusting, L. S., Scott, T. W., Lindsay, S. W., Hay, S. I., &amp; Smith, D. L. (2015). Adult vector control, mosquito ecology and malaria transmission. International Health, 7(2), 121–129.</p>
<p>Smith, D. L., Perkins, T. A., Tusting, L. S., Scott, T. W., &amp; Lindsay, S. W. (2013). Mosquito population regulation and larval source management in heterogeneous environments. PloS One, 8(8), e71247.</p>
</div>
<div id="modularized-equations" class="section level4">
<h4 class="hasAnchor">
<a href="#modularized-equations" class="anchor"></a>1.2.4 Modularized Equations</h4>
<p><img src="Dynamics.png" width="100%" style="display: block; margin: auto;"></p>
<hr>
<ul>
<li><p><span class="math inline">\(dL/dt\)</span> describes aquatic mosquito population dynamics</p></li>
<li><p><span class="math inline">\(dM/dt\)</span> describes adult mosquito population dynamics</p></li>
<li><p><span class="math inline">\(dY/dt\)</span> describes adult mosquito infection dynamics</p></li>
<li><p><span class="math inline">\(dP/dt\)</span> describes host infection dynamics</p></li>
</ul>
<p><span class="math display">\[\begin{equation}
\begin{array}{rl|rl}
\frac{dL}{dt} &amp;= F_L(G,L) &amp; G &amp;= F_G(M) \\ \\ 
\frac{dM}{dt} &amp;= F_M(\Lambda,M) &amp; \Lambda &amp;= F_\Lambda(L) \\ \\
\frac{dY}{dt} &amp;= F_Y(M,Y,\kappa) &amp; \kappa &amp;= F_\kappa(P) \\ \\
\frac{dP}{dt} &amp;= F_P(P,E,H) &amp; E &amp;= F_E(Y) \\ \\
\frac{dH}{dt} &amp;= F_H(P,H) &amp;   \\ \\
\end{array}
\end{equation}\]</span></p>
</div>
</div>
<div id="spatial-dynamics" class="section level3">
<h3 class="hasAnchor">
<a href="#spatial-dynamics" class="anchor"></a>1.3 Spatial Dynamics</h3>
<p>We implement spatial dynamics in a micro-simulation framework. By <em>microsimulation</em>, we mean specifically that the models are designed to simulate pathogen transmission on point sets (See Figure 1). We developed these models to address a family of problems that are intrinsically spatial, and we needed software that was capable of handling the spatial complexity. The software has been designed to support <strong>adaptive vector control</strong>, and the software was designed to be fully modular.</p>
<div id="figure-1" class="section level4">
<h4 class="hasAnchor">
<a href="#figure-1" class="anchor"></a>Figure 1</h4>
<p>The yellow circles in the figure identify most of the components of a micro-simulation model. A landscape is defined by a set of locations. Figure ` identifies two kinds of points: haunts where blood feeding occurs, <span class="math inline">\(\left\{f\right\}\)</span>, and habitats where mosquitoes lay eggs, <span class="math inline">\(\left\{l\right\}\)</span>. Mosquitoes move to find haunts and blood feed, <span class="math inline">\(F\)</span>, or to find habitats and lay eggs, <span class="math inline">\(L\)</span>. There is a set of human populations or humans, <span class="math inline">\(\left\{h\right\}\)</span>, that spend some time at the huants, <span class="math inline">\(H\)</span>. Mosquitoes find humans (or perhaps other vertebrate hosts) and take a blood meal, <span class="math inline">\(\gamma\)</span>.</p>
<div class="figure" style="text-align: center">
<img src="DynamicsOnPoints.png" alt="A framework for microsimulation on point sets (from Perkins, _et al._, 2013)" width="100%"><p class="caption">
A framework for microsimulation on point sets (from Perkins, <em>et al.</em>, 2013)
</p>
</div>
</div>
<div id="components" class="section level4">
<h4 class="hasAnchor">
<a href="#components" class="anchor"></a>Components</h4>
<p>This software package is a framework for making microsimulation models for mosquito-borne pathogens. The elements of Figure 1 are formalized in a set of modular code that defines specific ways for these models to interact. It is thus possible to define and run micro-simulation models. The elements of the model are:</p>
<ul>
<li>
<p>A <strong>Landscape</strong> is usually defined by two point sets:</p>
<ul>
<li><p>A set of <em>haunts</em>, where mosquitoes rest and where blood feeding occurs, <span class="math inline">\(\left\{ f \right\}\)</span>.</p></li>
<li><p>A set of <em>aquatic habitats</em> where mosquitoes lay eggs, <span class="math inline">\(\left\{ l \right\}\)</span>;</p></li>
</ul>
</li>
<li>
<p>A set of <strong>humans</strong> <span class="math inline">\(\left\{ h \right\}\)</span> (or more generally, a set of a populations of the pathogen’s hosts) is defined, either as individuals or as a set of sub-populations.</p>
<ul>
<li><p>A model for the infection dynamics, or more generally the <strong>epidemiology</strong>.</p></li>
<li><p>A model (<span class="math inline">\(H\)</span>) for how humans and other vertebrate hosts spend time the haunts, which is formalized into an object describing <code>TimeSpent</code>.</p></li>
</ul>
</li>
<li>
<p>We define <strong>pathogen</strong> population dynamics in the humans, including:</p>
<ul>
<li><p>A library of models for simulation <em>Plasmodium falciparum</em> infection and immunity.</p></li>
<li><p>A library of models for simulation West Nile Virus is also being developed.</p></li>
</ul>
</li>
<li>
<p>We define <strong>mosquito</strong> populations, including:</p>
<ul>
<li><p>Models describe the blood feeding behavior, population dynamics, and infection dynamics of pathogens in <strong>Adult Mosquito</strong> populations. Determinist and stochastic variants of several model families are defined in a model library.</p></li>
<li><p>Models describe the population dynamics of <strong>Aquatic Ecology</strong> mosquito populations. Determinist and stochastic variants of several model families are defined in a model library.</p></li>
<li><p>Each model for adult mosquito population dynamics must include functions describing adult mosquito dispersal as the result of a <strong>search</strong> to blood feed or lay eggs.</p></li>
<li><p>Models of <strong>Vector Control</strong> have been developed to simulate the effectds of vector-based interventions in arbitrary detail.</p></li>
</ul>
</li>
</ul>
<p>The core activity in this model is <strong>Blood Feeding</strong>. The software is modular, so that host movement and mosquito movement all work together to be sure there is a sensible way of describing blood feeding and pathogen <strong>Transmission.</strong> The model for blood feeding uses the landscape:</p>
<ul>
<li><p>A function that translates <code>TimeSpent</code> by humans into time at risk (or <code>TaR</code>). and biting among hosts at the haunts for each mosquito species, depending on their daily activity patterns.</p></li>
<li><p>Other hosts may also be present.</p></li>
<li><p>A function that computes <em>blood feeding success</em> for mosquitoes and host choice as a function of host availability</p></li>
<li>
<p>Next, we compute the distribution of bites among hosts and output</p>
<ul>
<li><p>The number of infective bites received by each host or host population</p></li>
<li><p>The probability a mosquito becomes infected after blood feeding</p></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div id="the-code" class="section level2">
<h2 class="hasAnchor">
<a href="#the-code" class="anchor"></a>2. The Code</h2>
<div id="section-1" class="section level3">
<h3 class="hasAnchor">
<a href="#section-1" class="anchor"></a>2.1</h3>
<p>The <code>Micro-MoB</code> project was created in the <code>R</code> language in the <code>RStudio</code> environment.</p>
<p>The software is developed, maintained, and documented in a set of <code>.Rmd</code> files. This top level document, <code>Micro-MoB.Rmd</code>, which you might be viewing as <code>MicroMoB.pdf</code> or <code>MicroMoB.html</code>, gives an overview.</p>
<p>The project is organized hierarchically, and the files have sensible names that indicate their position in the hierarchy, such as <code>Micro-Mosquito.Rmd</code> or <code>Micro-Mosquito-Adult.Rmd</code>. Model libraries, which define specific model families, have their <code>family</code> designation at the end of the filename, so <code>Micro-Mosquito-Adult-XX.Rmd</code> defines the adult mosquito model of the family <code>XX</code>. To avoid duplicating text and information, especially information that will need to be updated as the model libraries are extended, we will tend to push specific information into the appropriate lower level file.</p>
<p>The structure of the hierarchy reflects the structure of a microsimulation model:</p>
<ul>
<li><p><code>Micro-MoB.Rmd</code> (this file) contains some basic, high-level functions.</p></li>
<li><p><code>Micro-ModelObject.Rmd</code> describes the design of the model object in detail.</p></li>
<li><p><code>Micro-Landscape.Rmd</code> has utilities for constructing point-set landscapes and dispersal on point sets.</p></li>
<li>
<p><code>Micro-Human.Rmd</code> defines the function <code>HumanBehavior</code> and various functions.</p>
<ul>
<li><p><code>SpendTime()</code> is a core function describing human mobility.</p></li>
<li><p><code>Travel()</code> describes imported malaria, defined as exposure and infection outside of the landscape being simulated.</p></li>
<li><p><code>CareSeeking()</code> is a core concept that triggers treatment and sometimes other activities.</p></li>
</ul>
</li>
<li>
<p><code>Micro-Mosquito.Rmd</code> is the high-level document for mosquito microsimulation. It defines the function <code>MosquitoDynamics()</code>.</p>
<ul>
<li><p><code>Micro-Mosquito-Adult.Rmd</code> defines <code>dMdt()</code> and associated functions required to setup and simulate adult mosquito blood feeding behavior and infection dynamics. The model library for adult mosquitoes is the set of files <code>Micro-Mosquit-Adult-XX.Rmd</code> where <code>XX</code> is a moniker for the model family.</p></li>
<li><p><code>Micro-Mosquito-Aquatic.Rmd</code> defines <code>dLdt()</code> and defines various models for aquatic population dynamics. The model library for aquatic mosquitoes is the set of files <code>Micro-Mosquito-Aquatic-XX.Rmd</code> where <code>XX</code> is a moniker for the model family.</p></li>
</ul>
</li>
<li>
<p><code>Micro-VectorControl.Rmd</code> describes functions implement various modes of vector control, including:</p>
<ul>
<li><p><code>Micro-VectorControl-ITN.Rmd</code> defines several <em>ITN</em> models, including ownership, usage, protection, and the effects on mosquito populations.</p></li>
<li><p><code>Micro-VectorControl-IRS.Rmd</code> defines several IRS models.</p></li>
<li><p><code>Micro-VectorContro-LSM.Rmd</code> deinfes larval source management.</p></li>
</ul>
</li>
<li>
<p><code>Micro-BloodFeeding.Rmd</code> has several functions required to model blood feeding, which is an interaction between vertebrate hosts and mosquitoes.</p>
<ul>
<li><p>Models for simulating the presence of alternative blood meal hosts.</p></li>
<li><p>Models for simulating time at risk or <code>TaR</code></p></li>
<li><p>Models for simulating mosquito feeding success in relation to host availability,</p></li>
</ul>
</li>
<li>
<p><code>Micro-Pathogen.Rmd</code> defines the function call for pathogen infection dynamics, <code>dPdt()</code>. The model library describing host infection dynamics is in the set of files <code>Micro-Pathogen-XX.Rmd</code> where <code>XX</code> is the moniker for the model family.</p>
<ul>
<li><p><code>Micro-Pathogen-Pfalciparum.Rmd</code> is the base file for of <em>Plasmodium falciparum</em></p></li>
<li><p><code>Micro-Pathogen-Compartment.Rmd</code> has a set of generic compartment models.</p></li>
</ul>
</li>
<li><p><code>Mirco-Visualize.Rmd</code> has utilities for visualization.</p></li>
</ul>
</div>
<div id="purlall" class="section level3">
<h3 class="hasAnchor">
<a href="#purlall" class="anchor"></a>2.2 purlAll</h3>
<p>All of the files written in <code>.Rmd</code> files output <code>R</code> code using <code>purl</code>.</p>
<p>This function maintains a master list of all the document that define <code>MicroMoB</code>. Running <code>purlMicroMoB()</code> in <code>R</code> will remake all the <code>.R</code> files. To add new modules to the <code>MicroMoB</code> library, add them to this function.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">purlMicroMoB</span><span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span> 
  
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span>

  <span class="co"># This file</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-MoB.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/Micro.R"</span>, documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  
  <span class="co"># Design and implementation of the model object </span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-ModelObject.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroModelObject.R"</span>, documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-IO.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroIO.R"</span>, documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  
  <span class="co"># Landscape Utilities  </span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-Landscape.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroLandscape.R"</span>, documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  
  <span class="co"># Mosquito  </span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-Mosquito.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroMosquito.R"</span>, documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> 
  
  <span class="co"># Adult Mosquitoes</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-Mosquito-Adult.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroMosquitoAdult.R"</span>, documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  
  <span class="co"># The Adult Mosquito Model Library </span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-Mosquito-Adult-RM.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroMosquitoAdultRM.R"</span>, documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-Mosquito-Adult-BQ.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroMosquitoAdultBQ.R"</span>, documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-Mosquito-Adult-BQa.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroMosquitoAdultBQa.R"</span>, documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-Mosquito-Adult-BQi.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroMosquitoAdultBQi.R"</span>, documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-Mosquito-Adult-BQS.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroMosquitoAdultBQS.R"</span>, documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  
  <span class="co"># Aquatic Mosquitoes  </span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-Mosquito-Aquatic.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroMosquitoAquatic.R"</span>, documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  
  <span class="co"># The Aquatic Mosquito Model Library </span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-Mosquito-Aquatic-Trace.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroMosquitoAquaticTrace.R"</span>, documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-Mosquito-Aquatic-BH.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroMosquitoAquaticBH.R"</span>, documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-Mosquito-Aquatic-BC.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroMosquitoAquaticBC.R"</span>, documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-Mosquito-Aquatic-BCSS.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroMosquitoAquaticBCSS.R"</span>, documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-Mosquito-Aquatic-RBC.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroMosquitoAquaticRBC.R"</span>, documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  
  <span class="co"># The Vector Control Library </span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-VectorControl.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroVectorControl.R"</span>, documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-VectorControl-ITN.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroVectorControlITN.R"</span>, documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-VectorControl-IRS.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroVectorControlIRS.R"</span>, documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> 
  
  <span class="co"># Human </span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-Human.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroHuman.R"</span>, documentation<span class="op">=</span><span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
 
  <span class="co"># Blood Feeding </span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-BloodFeeding.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroBloodFeeding.R"</span>, documentation<span class="op">=</span><span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  
  <span class="co"># Pathogen </span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-Pathogen.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroPathogen.R"</span>, documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  
  <span class="co"># P. falciparum</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-Pathogen-PfSI.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/Micro-PfSI.R"</span>,  documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">tmp</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-Pathogen-PfEZAoY.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroPfezAoY.R"</span>, documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  
  <span class="co"># Compartment</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-Pathogen-SIR.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroSIR.R"</span>, documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-Intervene.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroIntervene.R"</span>,  documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">tmp</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-Intervene-RCD.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroInterveneRCD.R"</span>,  documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">tmp</span>
  
  <span class="co"># Visualization</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">purl</a></span><span class="op">(</span><span class="st">"Micro-Visualization.Rmd"</span>, output <span class="op">=</span> <span class="st">"Rcode/MicroVisualization.R"</span>, documentation <span class="op">=</span> <span class="fl">0</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
 
  
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Done with purlMicroMoB(). Run refreshMoB() to remake MicroMoB.R from *.R files in ./Rcode/"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="micromob-r" class="section level3">
<h3 class="hasAnchor">
<a href="#micromob-r" class="anchor"></a>MicroMoB.R</h3>
<p>The following code runs <code>purlMicroMoB.R</code> and contatenates all the <code>.R</code> files into a single file, <code>MicroMoB.R</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">refreshMoB</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span> 
  <span class="co"># Defined in Micro-MoB</span>
  <span class="co"># Defined in Micro-MoB</span>
  <span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="st">"rm *.R"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="st">"rm Rcode/*.R"</span><span class="op">)</span>
  <span class="fu">purlMicroMoB</span><span class="op">(</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="st">"cat Rcode/*.R &gt; MicroMoB.R"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"MicroMoB.R has been remade."</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">remob</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># Defined in Micro-MoB</span>
  <span class="fu">refreshMoB</span><span class="op">(</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span> <span class="op">(</span><span class="st">"MicroMoB.R"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"sourced MicroMoB.R"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>To be sure this file works, we source the <code>R</code> code:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span> <span class="op">(</span><span class="st">"MicroMoB.R"</span><span class="op">)</span></code></pre></div>
<p>If it did not work, when we would need to run <code>purlMicroMoB()</code>, remake <code>MicroMoB.R</code> and then source it. (We do not run <code>purlMicroMob()</code> by default because it would create a loop). If something goes wrong, run this block:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remob</span><span class="op">(</span><span class="op">)</span> </code></pre></div>
</div>
</div>
<div id="design" class="section level2">
<h2 class="hasAnchor">
<a href="#design" class="anchor"></a>3. Design</h2>
<div id="section-2" class="section level3">
<h3 class="hasAnchor">
<a href="#section-2" class="anchor"></a>3.1</h3>
<p>To implement a modular <strong>microsimulation</strong> framework, we designed code that was flexible and extensible. To facilitate model building, we designed utilities to help users set up models, modify the models, calibrate the models, and visualize the outputs.</p>
</div>
<div id="setting-up-a-model" class="section level3">
<h3 class="hasAnchor">
<a href="#setting-up-a-model" class="anchor"></a>3.2 Setting up a Model</h3>
<p>Simulation in <code>Micro-MoB</code> has a fixed structure.</p>
</div>
<div id="simulation" class="section level3">
<h3 class="hasAnchor">
<a href="#simulation" class="anchor"></a>3.3 Simulation</h3>
<div id="microsim-and-mosquitomicrosim" class="section level4">
<h4 class="hasAnchor">
<a href="#microsim-and-mosquitomicrosim" class="anchor"></a>3.3.1 <code>MicroSim</code> and <code>MosquitoMicroSim</code>
</h4>
<p>Simulations are designed for a purpose. Here, we have defined two core pieces of:</p>
<ul>
<li><p><code>dMicroSim</code> runs one time step of a Microsimulation model with all its components.</p></li>
<li><p><code>dMosquitoMicroSim</code> runs one time step of a microsimulation with only mosquitoes. Inputs from the humans are passed as a trace function.</p></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">MicroSimulation</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">Model</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Model</span><span class="op">$</span><span class="va">runtime</span>,<span class="op">{</span>
  <span class="co"># Defined in Micro-MoB</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="va">T0</span><span class="op">:</span><span class="va">Tmax</span><span class="op">)</span><span class="op">{</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">t</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="fl">100</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"t ="</span>, <span class="va">t</span><span class="op">)</span><span class="op">)</span> 
    <span class="va">Model</span> <span class="op">=</span> <span class="fu">dMicroSim</span><span class="op">(</span><span class="va">t</span>, <span class="va">Model</span><span class="op">)</span>
    <span class="va">Model</span> <span class="op">=</span> <span class="fu">IO</span><span class="op">(</span><span class="va">t</span>, <span class="va">Model</span><span class="op">)</span>
    <span class="va">Model</span> <span class="op">=</span> <span class="fu">Update</span><span class="op">(</span><span class="va">t</span>, <span class="va">Model</span><span class="op">)</span>
  <span class="op">}</span> 
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">Model</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span><span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">MosquitoMicroSim</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">Model</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Model</span><span class="op">$</span><span class="va">runtime</span>,<span class="op">{</span>
  <span class="co"># Defined in Micro-MoB</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="va">T0</span><span class="op">:</span><span class="va">Tmax</span><span class="op">)</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>t<span class="op">=</span><span class="va">t</span><span class="op">)</span><span class="op">)</span>
    <span class="va">Model</span> <span class="op">=</span> <span class="fu">dMosquitoMicroSim</span><span class="op">(</span><span class="va">t</span>, <span class="va">Model</span><span class="op">)</span>
    <span class="va">Model</span> <span class="op">=</span> <span class="fu">IO</span><span class="op">(</span><span class="va">t</span>, <span class="va">Model</span><span class="op">)</span>
  <span class="op">}</span> 
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">Model</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span><span class="op">}</span></code></pre></div>
</div>
<div id="dmicrosim-and-dmosquitomicrosim" class="section level4">
<h4 class="hasAnchor">
<a href="#dmicrosim-and-dmosquitomicrosim" class="anchor"></a>3.3.2 <code>dMicroSim</code> and <code>dMosquitoMicroSim</code>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dMicroSim</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># Defined in Micro-MoB</span>
  <span class="co">##########################################</span>
  <span class="co"># + IRS Spraying</span>
  <span class="co"># + ITN Mass Distribution</span>
  <span class="co"># ... and other modes of vector control</span>
  <span class="co"># + Mass Treatment</span>
  <span class="co"># + Reactive Case Detection</span>
  <span class="co"># ... and other health-based interventions</span>
  <span class="co">##########################################</span>
  <span class="va">Mod</span> <span class="op">=</span> <span class="fu">Intervene</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span>
  
  <span class="co">##########################################</span>
  <span class="co">#  Called by: </span>
  <span class="co">#    + some models of aquatic mosquito</span>
  <span class="co">#      populations with dynamic resources </span>
  <span class="co">#      &amp; resource-based competition. </span>
  <span class="co">#########################################</span>
  <span class="co">#Mod = Update(t, Mod)  </span>

  <span class="co">###########################</span>
  <span class="co"># Micro-Human.Rmd </span>
  <span class="co"># + TimeSpent</span>
  <span class="co"># + MyITN, UseITN</span>
  <span class="co">###########################</span>
  <span class="va">Mod</span> <span class="op">=</span> <span class="fu">HumanBehavior</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span>

  <span class="co">###########################</span>
  <span class="co"># VectorControl.Rmd </span>
  <span class="co"># + ITNs, IRS, LSM</span>
  <span class="co">###########################</span>
  <span class="va">Mod</span> <span class="op">=</span> <span class="fu">VectorControlEffects</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span>

  <span class="co">#######################</span>
  <span class="co"># Micro-BloodFeeding.Rmd</span>
  <span class="co"># + FeedingSuccess modifies MPars$psi</span>
  <span class="co"># + kappa, eir, Q</span>
  <span class="co">#######################</span>
  <span class="va">Mod</span> <span class="op">=</span> <span class="fu">BloodFeeding</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span>
  
  <span class="co">##############################</span>
  <span class="co"># Micro-Mosquito.Rmd</span>
  <span class="co"># Micro-Mosquito-Adult.Rmd</span>
  <span class="co"># Micro-Mosquito-Aquatic.Rmd</span>
  <span class="co"># + dMdt</span>
  <span class="co"># + dLdt</span>
  <span class="co">##############################</span>
  <span class="va">Mod</span> <span class="op">=</span> <span class="fu">MosquitoDynamics</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span> 

  <span class="co">###############################</span>
  <span class="co"># HumanMicro.Rmd</span>
  <span class="co"># + P.falciparum</span>
  <span class="co">###############################</span>
  <span class="va">Mod</span> <span class="op">=</span> <span class="fu">InfectionDynamics</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">Mod</span><span class="op">)</span> 
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dMosquitoMicroSim</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># Defined in Micro-MoB</span>
  <span class="co">###########################</span>
  <span class="co"># VectorControl.Rmd </span>
  <span class="co"># + ITNs, IRS, LSM</span>
  <span class="co">###########################</span>
  <span class="va">Mod</span> <span class="op">=</span> <span class="fu">VectorControl</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span>

  <span class="co">#######################</span>
  <span class="co"># BloodFeeding.Rmd </span>
  <span class="co"># + Feeding Success</span>
  <span class="co"># + kappa, passed as a trace</span>
  <span class="co"># + eir</span>
  <span class="co">#######################</span>
  <span class="va">Mod</span> <span class="op">=</span> <span class="fu">BloodFeeding</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span>
  
  <span class="co">##############################</span>
  <span class="co"># MosquitoMicrosimulation.Rmd</span>
  <span class="co"># + dMdt</span>
  <span class="co"># + dLdt</span>
  <span class="co">##############################</span>
  <span class="va">Mod</span> <span class="op">=</span> <span class="fu">MosquitoDynamics</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span> 
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">Mod</span><span class="op">)</span> 
<span class="op">}</span></code></pre></div>
</div>
<div id="pseudocode" class="section level4">
<h4 class="hasAnchor">
<a href="#pseudocode" class="anchor"></a>3.3.3 Pseudocode</h4>
<p>This pseudocode describes ‘dMicroSim’. It is possible to run only a subset of these algorithms, passing the required arguments as traces.</p>
<p><strong>Human Behavior</strong></p>
<p>Human behaviors relevant for malaria dynamics and control come first.</p>
<ul>
<li><p><em>Time Spent</em>: To model blood feeding, we first determine the location of humans when they are not traveling. An algorithm generates an object called <code>TimeSpent.</code></p></li>
<li><p><em>Travel</em>: To model imported malaria, we need to simulate travel outside of the area.</p></li>
<li><p><em>MyITN</em>: Dynamics of ITN ownership, including ITN damage, replacement and loss.</p></li>
<li><p><em>UseITN</em>: Human use of ITNs affects mosquito blood feeding behaviors. This function models ITN usage.</p></li>
<li><p><em>SeekCare</em>: Care seeking is simulated explicitly in some simulations, which allows humans to show up at a clinic.</p></li>
<li><p>…</p></li>
</ul>
<p><strong>Vector Control</strong></p>
<p>How is transmission by mosquitoes modified by control?</p>
<ul>
<li>
<p><em>Baseline</em>:</p>
<ul>
<li><p>To set up vector control for any given day, we need to reset <code>MPars</code> to <code>MBase</code> and <code>LPars</code> to <code>LBase</code>.</p></li>
<li><p>The following algorithms modify <code>MPars</code> and <code>LPars</code> to reflect modifications to mosquito feeding success and survival affected by vector control.</p></li>
</ul>
</li>
<li>
<p><em>ITN</em></p>
<ul>
<li><p>ITN ownership and usage are human behaviors. They are managed by <em>MyITN</em> and <em>UseITN</em>, which set up the ITN model.</p></li>
<li><p>ITN use increases contact with the net, which reduces daily mosquito survival in <code>MPars</code></p></li>
<li><p>ITN use modifies human biting weights to reduce blood feeding success.</p></li>
<li><p>(OPT) In <code>MPars</code>, modify seach weights and mosquito search in <code>PsiBB</code> and <code>PsiQB</code></p></li>
</ul>
</li>
<li>
<p><em>IRS</em></p>
<ul>
<li><p><em>IRS</em> modifies mosquito survival at sprayed haunts in <code>MPars</code></p></li>
<li><p>(OPT) <em>IRS</em> could also modify mosquito search, affecting <code>PsiBB</code> and <code>PsiQB</code></p></li>
</ul>
</li>
<li>
<p><em>LSM</em></p>
<ul>
<li><p>Modify <code>LPars</code></p></li>
<li><p>(OPT) In <code>MPars</code>, modify seach weights and mosquito search in <code>PsiBB</code> and <code>PsiQB</code></p></li>
</ul>
</li>
</ul>
<p><strong>Blood Feeding</strong></p>
<p>For each mosquito species (or population):</p>
<ul>
<li><p>Derive <code>TaR</code> from <code>TimeSpent</code></p></li>
<li><p>Derive <code>SiG</code> from <code>TaR</code> + human population density + search weights (<code>SiG</code> = Skin in the Game)</p></li>
<li><p>Derive <code>DiB</code> from <code>SiG</code> (<code>DiB</code> is distributed bites)</p></li>
<li><p>Compute <em>Feeding Success</em> and set <code>psiB</code></p></li>
<li>
<p>Compute and store</p>
<ul>
<li><p><code>eir</code></p></li>
<li><p><code>kappa</code></p></li>
<li><p><code>Q</code></p></li>
</ul>
</li>
</ul>
<p><strong>Mosquito Dynamics</strong></p>
<ul>
<li><p>Run adult mosquito population dynamics (requires <code>kappa</code>)</p></li>
<li><p>Run aquatic mosquito population dynamics</p></li>
</ul>
<p><strong>Infection Dynamics</strong></p>
<ul>
<li>Run the infection dynamics (requires ‘eir’)</li>
</ul>
<p>The following sections show how to setup and</p>
<div id="mosquitomicrosim" class="section level5">
<h5 class="hasAnchor">
<a href="#mosquitomicrosim" class="anchor"></a>MosquitoMicroSim</h5>
</div>
</div>
</div>
</div>
<div id="demo" class="section level2">
<h2 class="hasAnchor">
<a href="#demo" class="anchor"></a>4. Demo</h2>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span> <span class="op">=</span> <span class="fu">makeModel.demo</span><span class="op">(</span><span class="op">)</span> 
<span class="co">#plotPoints(model$landscape)</span>
<span class="co">#plotKernels(model$landscape, model$mosquito[[1]])</span>
<span class="co">#NullModel = addSample(NullModel, "rmpr")</span>
<span class="co">#nm1 = HumanBehavior(0, NullModel)</span>
<span class="co">#nm2 = VectorControl(0, nm1)</span>
<span class="co">#nm3 = BloodFeeding(0, nm2)</span>
<span class="co">#nm4 = MosquitoDynamics(0, nm3)</span>
<span class="co">#nm5 = InfectionDynamics(0, nm4)</span>
<span class="co">#nm6 = Sample(0, nm5, 1)</span>
<span class="co">#nm7 = Sample(0, nm6, 2)</span>
<span class="co">#NM0 = dMicroSim(0, NullModel)</span>
<span class="co">#NM1 = Sampling(0, NM0)</span>
<span class="co">#NM2 = dMicroSim(1,NM1)</span>
<span class="co">#NullModel = MicroSim(NullModel)</span></code></pre></div>
</div>
<div id="model-building" class="section level2">
<h2 class="hasAnchor">
<a href="#model-building" class="anchor"></a>5. Model Building</h2>
<p>This software has been designed</p>
<div id="section-3" class="section level3">
<h3 class="hasAnchor">
<a href="#section-3" class="anchor"></a>.</h3>
</div>
<div id="landscapes" class="section level3">
<h3 class="hasAnchor">
<a href="#landscapes" class="anchor"></a>Landscapes</h3>
<div id="section-4" class="section level4">
<h4 class="hasAnchor">
<a href="#section-4" class="anchor"></a>.</h4>
<p>To run a microsimulation, it is necessary to create a <code>Model Object</code>:</p>
<ul>
<li><p>Utilities to set up the <strong>landscape</strong> are described in <code>PointSets.Rmd.</code> Relevant functions can be sourced from <code>PointSets.R</code>.</p></li>
<li><p>Utilities to set up mosquito dispersal kernels are in <code>MosquitoDispersal.Rmd.</code> Relevant functions can be sourced from <code>Kernels.R</code>.</p></li>
</ul>
</div>
</div>
<div id="humans" class="section level3">
<h3 class="hasAnchor">
<a href="#humans" class="anchor"></a>Humans</h3>
<div id="behaviors" class="section level4">
<h4 class="hasAnchor">
<a href="#behaviors" class="anchor"></a>Behaviors</h4>
<ul>
<li>Models for time at risk are defined in <code>TaR.Rmd</code>, and relevant functions are sourced in <code>TaR.R</code>.</li>
</ul>
</div>
<div id="infection-dynamics" class="section level4">
<h4 class="hasAnchor">
<a href="#infection-dynamics" class="anchor"></a>Infection Dynamics</h4>
<ul>
<li>Models for infection, given exposure, are defined in <code>Malaria.Rmd,</code> and relevant functions are sourced in <code>Malaria.R</code>
</li>
</ul>
</div>
</div>
<div id="blood-feeding" class="section level3">
<h3 class="hasAnchor">
<a href="#blood-feeding" class="anchor"></a>Blood Feeding</h3>
</div>
<div id="mosquitoes" class="section level3">
<h3 class="hasAnchor">
<a href="#mosquitoes" class="anchor"></a>Mosquitoes</h3>
<ul>
<li>
<p>Mosquito microsimulation is set up in <code>MosquitoMicrosimulation.Rmd</code>. Relevant functions can be sourced from <code>MosquitoMicrosimulation.R</code>. The two components of microsimulation are setup in separate files:</p>
<ul>
<li><p>Models for adult mosquito population dynamics are described in <code>AdultMicroecology.Rmd</code>, and relevant functions can be sourced from <code>AdultMicroecology.R</code></p></li>
<li><p>Models for aquatic population dynamics are defined in <code>AquaticDynamics.Rmd</code>, and relevant functions can be sourced from <code>Aquatic.R</code>.</p></li>
</ul>
</li>
<li><p>Transmission is described in <code>loodMeal.Rmd</code> and relevant functions are sourced in <code>bloodmeal.R</code></p></li>
</ul>
</div>
<div id="vector-control" class="section level3">
<h3 class="hasAnchor">
<a href="#vector-control" class="anchor"></a>Vector Control</h3>
<div id="mosquito-microsimulation" class="section level4">
<h4 class="hasAnchor">
<a href="#mosquito-microsimulation" class="anchor"></a>Mosquito Microsimulation</h4>
<p>Mosquito microsimulation can be run independently (see <code>MosquitoMicrosimulation.Rmd</code>).</p>
</div>
</div>
</div>
<div id="analytics" class="section level2">
<h2 class="hasAnchor">
<a href="#analytics" class="anchor"></a>6. Analytics</h2>
<div id="section-5" class="section level3">
<h3 class="hasAnchor">
<a href="#section-5" class="anchor"></a>.</h3>
</div>
<div id="version-control" class="section level3">
<h3 class="hasAnchor">
<a href="#version-control" class="anchor"></a>Version Control</h3>
</div>
<div id="calibration" class="section level3">
<h3 class="hasAnchor">
<a href="#calibration" class="anchor"></a>Calibration</h3>
</div>
<div id="visualization" class="section level3">
<h3 class="hasAnchor">
<a href="#visualization" class="anchor"></a>Visualization</h3>
<p>Write me.</p>
</div>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<ul>
<li><p>Perkins TA, <em>et al.</em>, (2013). Heterogeneity, mixing, and the spatial scales of mosquito-borne pathogen transmission. PLoS Computational Biology, 9(12), e1003327.</p></li>
<li><p>Smith DL, <em>et al.</em>, (2014). Recasting the theory of mosquito-borne pathogen transmission dynamics and control. Transactions of the Royal Society of Tropical Medicine and Hygiene, 108(4), 185–197.</p></li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Sean L. Wu, David L. Smith.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
