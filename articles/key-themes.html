<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="MicroMoB">
<title>key-themes • MicroMoB</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="key-themes">
<meta property="og:description" content="MicroMoB">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MicroMoB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/BH_aqua.html">Beverton-Holt aquatic model</a>
    <a class="dropdown-item" href="../articles/Contributing.html">Contributing</a>
    <a class="dropdown-item" href="../articles/Micro-MoB.html">Micro-MoB</a>
    <a class="dropdown-item" href="../articles/RM_mosquito.html">Ross-Macdonald mosquito model</a>
    <a class="dropdown-item" href="../articles/RM_transmission.html">Ross-Macdonald transmission model</a>
    <a class="dropdown-item" href="../articles/key-themes.html">key-themes</a>
    <a class="dropdown-item" href="../articles/math.html">math</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dd-harp/MicroMoB/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">

<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>key-themes</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dd-harp/MicroMoB/blob/HEAD/vignettes/key-themes.Rmd" class="external-link"><code>vignettes/key-themes.Rmd</code></a></small>
      <div class="d-none name"><code>key-themes.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dd-harp/MicroMoB" class="external-link">MicroMoB</a></span><span class="op">)</span></code></pre></div>
<p>Here we are going to talk about some key themes to follow while building this software library.</p>
<div class="section level2">
<h2 id="data-provenance">Data provenance<a class="anchor" aria-label="anchor" href="#data-provenance"></a>
</h2>
<p>It should be clear how external input data gets turned into the parameters used by Micro-MoB during simulation. Specifically, if we define some tree structure of data such that the leaves are mutually exclusive (e.g.; entomology, vector control, human movement, drug treatment, etc), we know for each data structure and function what leaves they use.</p>
<p>This is important because it lets us figure out what changes when data changes.</p>
</div>
<div class="section level2">
<h2 id="model-structure">Model structure<a class="anchor" aria-label="anchor" href="#model-structure"></a>
</h2>
<p>We need to get a list of model state objects, and updating functions. Then we need to describe how the process executes a time step. This helps us uncover hidden constraints in the model.</p>
<p>This is also a step closer to being able to construct multiple representations of the model (e.g. as machines or resource sharers).</p>
</div>
<div class="section level2">
<h2 id="extensions">Extensions<a class="anchor" aria-label="anchor" href="#extensions"></a>
</h2>
<p>It needs to be clear how to link to this package from another package if you want to extend the methods here. We need to think about what kind of a simulation engine we are making and how other people will extend it.</p>
<p>One thing we can do here is make the basic state objects (see above topic) and define how to queue updates and access them, and a simulation loop that updates them, then users can write their own processes. Like what we do with individual but with more enforced constraints.</p>
</div>
<div class="section level2">
<h2 id="software-design">Software design<a class="anchor" aria-label="anchor" href="#software-design"></a>
</h2>
<p>Once we establish what are the data structures that store persistent state in the model, we need to decide how to enforce some kind of type consistency for them. This assumes that those data structures will be used by <em>all</em> models that can be built using Micro-MoB.</p>
<p>One way is to use assertions prior to calling <code>UseMethod</code> to make sure that the required inputs are provided.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">BloodFeeding</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"BloodFeeding"</span>, <span class="va">Mod</span><span class="op">$</span><span class="va">bloodfeedingPars</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>This is probably the right way to do things. The outer generic function can just check that some bare minimum of input exists. The implemented specific function can do further checking based on its internal state representation.</p>
<p>Another way would be more complex. We could enforce that users interact with the model object through an interface which ensures consistency.</p>
<p>An easy performance thing is to make everything a <code>Matrix</code> object so that matrix mult is faster.</p>
</div>
<div class="section level2">
<h2 id="model-object">Model object<a class="anchor" aria-label="anchor" href="#model-object"></a>
</h2>
<p>We should store the model object as an environment. <a href="https://gist.github.com/slwu89/a294203e6d6679b923276030516684d7" class="external-link">This gist</a> shows why. Luckily conversion to-from is as easy as <code>list2env</code> and <code>as.list</code>.</p>
</div>
<div class="section level2">
<h2 id="analysis">Analysis<a class="anchor" aria-label="anchor" href="#analysis"></a>
</h2>
<p>One thing that would be nice is for each model, no matter how complex, we’d like to compute quantities that are “standard parameters”, such as feeding rate, human blood index, etc. The fundamental RM parameters should be computable from model parameters without simulation.</p>
</div>
<div class="section level2">
<h2 id="simulation-update">Simulation update<a class="anchor" aria-label="anchor" href="#simulation-update"></a>
</h2>
<div class="section level3">
<h3 id="simulation-loop">Simulation loop<a class="anchor" aria-label="anchor" href="#simulation-loop"></a>
</h3>
<p>Here it is:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">MicroSimulation</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">Model</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">Model</span><span class="op">$</span><span class="va">runtime</span>,<span class="op">{</span>
  <span class="co"># Defined in Micro-MoB</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="va">T0</span><span class="op">:</span><span class="va">Tmax</span><span class="op">)</span><span class="op">{</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">t</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">100</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"t ="</span>, <span class="va">t</span><span class="op">)</span><span class="op">)</span> 
    <span class="va">Model</span> <span class="op">=</span> <span class="fu">dMicroSim</span><span class="op">(</span><span class="va">t</span>, <span class="va">Model</span><span class="op">)</span>
    <span class="va">Model</span> <span class="op">=</span> <span class="fu">IO</span><span class="op">(</span><span class="va">t</span>, <span class="va">Model</span><span class="op">)</span>
    <span class="va">Model</span> <span class="op">=</span> <span class="fu">Update</span><span class="op">(</span><span class="va">t</span>, <span class="va">Model</span><span class="op">)</span>
  <span class="op">}</span> 
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">Model</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span><span class="op">}</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="update">Update<a class="anchor" aria-label="anchor" href="#update"></a>
</h3>
<p>There’s a couple of ways to do a discrete time simulation, regardless of if it is seen as a discretization of an underlying continuous time process or the model is developed “from scratch” as a discrete time model (this amounts to asking if a rate or a probability is the fundamental quantity specified by a modeler).</p>
<p>Anyway for discrete time, we basically can either do:</p>
<ol style="list-style-type: decimal">
<li>Synchronous update - this is like how cellular automata work (usually), all units which may undergo a state change draw their state changes simultaneously based on the same (yet unchanged) state. All updates are then applied instantaneously. This is what individual does, even though it doesn’t initially appear to be the case, because updated are merely queued by processes, they aren’t applied until the time step ends.</li>
<li>Asynchronous update - this is what Micro-MoB does. State is updated by processes which are executed during each time step. This requires more caution, although it can result in processes functions which are shorter and more specialized. Basically, state that is used to compute probabilities or proportions <em>cannot</em> be modified until it is no longer being used to compute those dynamic values.</li>
</ol>
<p>The former means you need to spend more time working on the model’s engine … its software architecture. That’s why individual has such a large amount of code dedicated to queuing and executing state updates. So you spend some upfront cost, but you get to have more leeway with your model processes.</p>
<p>The latter is easier to get running with right away and is a bit more freewheeling. But you need to be very careful about the execution order of processes. The upshot is that it may be easier to compartmentalize functions that work on smaller parts of state.</p>
<p>The terms synchronous and asynchronous are wrong, because these mean quite different things <a href="https://en.wikipedia.org/wiki/Asynchronous_cellular_automaton" class="external-link">when used rigorously</a>. We’re just talking about queuing updates that execute all at once versus executing updates sequentially in such a way that it mimics queuing those updates.</p>
<p>The update loop is fundamental. Let’s see what it says:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dMicroSim</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># Defined in Micro-MoB</span>
  <span class="co">##########################################</span>
  <span class="co"># + IRS Spraying</span>
  <span class="co"># + ITN Mass Distribution</span>
  <span class="co"># ... and other modes of vector control</span>
  <span class="co"># + Mass Treatment</span>
  <span class="co"># + Reactive Case Detection</span>
  <span class="co"># ... and other health-based interventions</span>
  <span class="co">##########################################</span>
  <span class="va">Mod</span> <span class="op">=</span> <span class="fu">Intervene</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span>
  
  <span class="co">##########################################</span>
  <span class="co">#  Called by: </span>
  <span class="co">#    + some models of aquatic mosquito</span>
  <span class="co">#      populations with dynamic resources </span>
  <span class="co">#      &amp; resource-based competition. </span>
  <span class="co">#########################################</span>
  <span class="co">#Mod = Update(t, Mod)  </span>

  <span class="co">###########################</span>
  <span class="co"># Micro-Human.Rmd </span>
  <span class="co"># + TimeSpent</span>
  <span class="co"># + MyITN, UseITN</span>
  <span class="co">###########################</span>
  <span class="va">Mod</span> <span class="op">=</span> <span class="fu">HumanBehavior</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span>

  <span class="co">###########################</span>
  <span class="co"># VectorControl.Rmd </span>
  <span class="co"># + ITNs, IRS, LSM</span>
  <span class="co">###########################</span>
  <span class="va">Mod</span> <span class="op">=</span> <span class="fu">VectorControlEffects</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span>

  <span class="co">#######################</span>
  <span class="co"># Micro-BloodFeeding.Rmd</span>
  <span class="co"># + FeedingSuccess modifies MPars$psi</span>
  <span class="co"># + kappa, eir, Q</span>
  <span class="co">#######################</span>
  <span class="va">Mod</span> <span class="op">=</span> <span class="fu">BloodFeeding</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span>
  
  <span class="co">##############################</span>
  <span class="co"># Micro-Mosquito.Rmd</span>
  <span class="co"># Micro-Mosquito-Adult.Rmd</span>
  <span class="co"># Micro-Mosquito-Aquatic.Rmd</span>
  <span class="co"># + dMdt</span>
  <span class="co"># + dLdt</span>
  <span class="co">##############################</span>
  <span class="va">Mod</span> <span class="op">=</span> <span class="fu">MosquitoDynamics</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span> 

  <span class="co">###############################</span>
  <span class="co"># HumanMicro.Rmd</span>
  <span class="co"># + P.falciparum</span>
  <span class="co">###############################</span>
  <span class="va">Mod</span> <span class="op">=</span> <span class="fu">InfectionDynamics</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">Mod</span><span class="op">)</span> 
<span class="op">}</span></code></pre></div>
<p>So here’s the order in which things happen:</p>
<ol style="list-style-type: decimal">
<li>
<code>Intervene</code> - this instantaneously changes model state before anything happens. In this sense it happens “between” the ticks of the clock, so that all updates see the newly intervened-upon state when they execute their updates on this day.</li>
<li>
<code>Update</code> - currently unused. I guess it updates the aquatic populations? That should be ok, as long as adults are not modified until <code>MosquitoDynamics</code>.</li>
<li>
<code>HumanBehavior</code> -</li>
</ol>
<p>Okay, so we need to specify what parts of state are “out of bounds” for updating prior to a certain point in the loop. What we mean is that it’s easier to shoot yourself in the foot this way, for example if someone (for some reason …) made a <code>Update</code> function that killed adult mosquitoes, that would break the contract that process has with other updating processes, because downstream processes need the unmodified adult mosquito state to calculate probabilities. If we did this, we’d be updating adult mosquitoes more than once, which isn’t okay.</p>
<p>Another way to see this is by thinking of a SIR model with birth and death. In discrete time it might look like this.</p>
<p><span class="math display">\[\begin{equation}
\begin{array}{rl}
S(t+1) &amp;= S(t) + b N(t) - \beta S(t) I(t) - \mu S(t) \\
I(t+1) &amp;= I(t) + \beta S(t) I(t) - \gamma I(t) - \mu I(t) \\
R(t+1) &amp;= R(t) + \gamma I(t) - \mu R(t)
\end{array}
\end{equation}\]</span></p>
<p>Now let’s say we do things wrong. Let’s execute a demographics function and update state before infection.</p>
<p><span class="math display">\[\begin{equation}
\begin{array}{rl}
S^{\prime}(t) &amp;= S(t) + b N(t) - \mu S(t) \\
I^{\prime}(t) &amp;= I(t) - \mu I(t) \\
R^{\prime}(t) &amp;= R(t) - \mu R(t)
\end{array}
\end{equation}\]</span></p>
<p>Ok, now let’s apply the infection function.</p>
<p><span class="math display">\[\begin{equation}
\begin{array}{rl}
S^{\prime}(t+1) &amp;= S^{\prime}(t) - \beta S^{\prime}(t)I^{\prime}(t) \\
I^{\prime}(t+1) &amp;= I^{\prime}(t) + \beta S^{\prime}(t)I^{\prime}(t) - \gamma I^{\prime}(t) \\
R^{\prime}(t+1) &amp;= R^{\prime}(t)  + \gamma I^{\prime}(t)
\end{array}
\end{equation}\]</span></p>
<p>Which aren’t equivalent.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">b</span> <span class="op">&lt;-</span> <span class="fl">0.01</span>
<span class="va">beta</span> <span class="op">&lt;-</span> <span class="fl">0.0025</span>
<span class="va">mu</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">70</span>
<span class="va">gamma</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">7</span>
<span class="va">SIR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">50</span>, <span class="fl">10</span><span class="op">)</span>

<span class="va">synchronous_sir</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sir</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">s</span> <span class="op">&lt;-</span> <span class="va">sir</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>; <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">sir</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>; <span class="va">r</span> <span class="op">&lt;-</span> <span class="va">sir</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>
  <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">s</span> <span class="op">+</span> <span class="va">i</span> <span class="op">+</span> <span class="va">r</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>
    <span class="va">s</span> <span class="op">+</span> <span class="op">(</span><span class="va">b</span><span class="op">*</span><span class="va">n</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">beta</span><span class="op">*</span><span class="va">s</span><span class="op">*</span><span class="va">i</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">mu</span><span class="op">*</span><span class="va">s</span><span class="op">)</span>,
    <span class="va">i</span> <span class="op">+</span> <span class="op">(</span><span class="va">beta</span><span class="op">*</span><span class="va">s</span><span class="op">*</span><span class="va">i</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">gamma</span><span class="op">*</span><span class="va">i</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">mu</span><span class="op">*</span><span class="va">i</span><span class="op">)</span>,
    <span class="va">r</span> <span class="op">+</span> <span class="op">(</span><span class="va">gamma</span><span class="op">*</span><span class="va">i</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">mu</span><span class="op">*</span><span class="va">r</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="va">asynchronous_sir_demographics</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sir</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">s</span> <span class="op">&lt;-</span> <span class="va">sir</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>; <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">sir</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>; <span class="va">r</span> <span class="op">&lt;-</span> <span class="va">sir</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>
  <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">s</span> <span class="op">+</span> <span class="va">i</span> <span class="op">+</span> <span class="va">r</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>
    <span class="va">s</span> <span class="op">+</span> <span class="op">(</span><span class="va">b</span><span class="op">*</span><span class="va">n</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">mu</span><span class="op">*</span><span class="va">s</span><span class="op">)</span>,
    <span class="va">i</span> <span class="op">-</span> <span class="op">(</span><span class="va">mu</span><span class="op">*</span><span class="va">i</span><span class="op">)</span>,
    <span class="va">r</span> <span class="op">-</span> <span class="op">(</span><span class="va">mu</span><span class="op">*</span><span class="va">r</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="va">asynchronous_sir_infection</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sir</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">s</span> <span class="op">&lt;-</span> <span class="va">sir</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>; <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">sir</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>; <span class="va">r</span> <span class="op">&lt;-</span> <span class="va">sir</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>
  <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">s</span> <span class="op">+</span> <span class="va">i</span> <span class="op">+</span> <span class="va">r</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>
    <span class="va">s</span> <span class="op">-</span> <span class="op">(</span><span class="va">beta</span><span class="op">*</span><span class="va">s</span><span class="op">*</span><span class="va">i</span><span class="op">)</span>,
    <span class="va">i</span> <span class="op">+</span> <span class="op">(</span><span class="va">beta</span><span class="op">*</span><span class="va">s</span><span class="op">*</span><span class="va">i</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">gamma</span><span class="op">*</span><span class="va">i</span><span class="op">)</span>,
    <span class="va">r</span> <span class="op">+</span> <span class="op">(</span><span class="va">gamma</span><span class="op">*</span><span class="va">i</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="va">sync_sir</span> <span class="op">&lt;-</span> <span class="fu">synchronous_sir</span><span class="op">(</span><span class="va">SIR</span><span class="op">)</span>

<span class="va">sync_sir_d</span> <span class="op">&lt;-</span> <span class="fu">asynchronous_sir_demographics</span><span class="op">(</span><span class="va">SIR</span><span class="op">)</span>
<span class="va">sync_sir_i</span> <span class="op">&lt;-</span> <span class="fu">asynchronous_sir_infection</span><span class="op">(</span><span class="va">sync_sir_d</span><span class="op">)</span>

<span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">sync_sir</span>, <span class="va">sync_sir_i</span><span class="op">)</span>,row.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Synchronous"</span>, <span class="st">"Asynchronous"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"I"</span>, <span class="st">"R"</span><span class="op">)</span>
<span class="va">dt</span>
<span class="co">#&gt;                     S        I        R</span>
<span class="co">#&gt; Synchronous  435.9571 104.6429 17.00000</span>
<span class="co">#&gt; Asynchronous 437.0401 103.6619 16.89796</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="data-structures-processes">Data structures &amp; processes<a class="anchor" aria-label="anchor" href="#data-structures-processes"></a>
</h2>
<p>Data structures are how the model stores state. Not all parts of state are the minimum state (the state required to specify the model and sample/compute the next update). Let’s call anything thats part of the minimum model state to be <em>persistent state</em> and anything else <em>transient state</em> (e.g., predictable functions of the history of the process).</p>
<p>The best way to go about this by looking at all the update functions which are executed each time step and see what they input and what they output (or, what they compute or update).</p>
<p>What we want to do is this (I think). For each of these update/component functions we want to dispatch on an object class that contains everything that function will update (“output”) and also contains all relevant parameters (<code>Update</code> might be an exception). We want to make clear what other model objects it uses to compute those (“input”).</p>
<div class="section level3">
<h3 id="intervene">Intervene<a class="anchor" aria-label="anchor" href="#intervene"></a>
</h3>
<p>This is described in <code>Micro-Intervene.Rmd</code>. It looks like this and is currently not implemented.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Intervene</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># Defined in Micro-Intervene.Rmd</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Mod</span><span class="op">$</span><span class="va">intervene</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span>
    <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Mod</span><span class="op">$</span><span class="va">intervene</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
      <span class="va">Mod</span> <span class="op">=</span> <span class="fu">intervene</span><span class="op">(</span><span class="va">i</span>,<span class="va">t</span>,<span class="va">Mod</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">Mod</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="section level4">
<h4 id="input">Input<a class="anchor" aria-label="anchor" href="#input"></a>
</h4>
<ul>
<li>
<code>Mod$intervene</code>: a list of interventions I suppose. I guess <code>intervene</code> then dispatches based on the class of each intervention in the list.</li>
</ul>
</div>
<div class="section level4">
<h4 id="output">Output<a class="anchor" aria-label="anchor" href="#output"></a>
</h4>
<p>None yet.</p>
</div>
</div>
<div class="section level3">
<h3 id="update-1">Update<a class="anchor" aria-label="anchor" href="#update-1"></a>
</h3>
<p>This is described in <code>Micro-ModelObject.Rmd</code>. It looks like this and is currently not implemented.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Update</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># Defined in Micro-ModelObject.Rmd</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Mod</span><span class="op">$</span><span class="va">update</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span>
    <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Mod</span><span class="op">$</span><span class="va">update</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
      <span class="va">Mod</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/update.dev.pkg.html" class="external-link">update</a></span><span class="op">(</span><span class="va">i</span>,<span class="va">t</span>,<span class="va">Mod</span><span class="op">)</span> 
    <span class="op">}</span> 
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">Mod</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>An update is a generic function in a list that can change parameters or other features of a model.</p>
<ul>
<li><p><code>update$F</code> is a function of the form <code>F(t, Mod, pars)</code></p></li>
<li><p><code>update$pars</code> holds the parameters passed to the function <code>F</code></p></li>
</ul>
<p>The <code>update</code> object is an arbitrarily long list of updates.</p>
<div class="section level4">
<h4 id="input-1">Input<a class="anchor" aria-label="anchor" href="#input-1"></a>
</h4>
<ul>
<li>
<code>Mod$update</code>: a list of updates I suppose. I guess <code>update</code> then dispatches based on the class of each intervention in the list.</li>
</ul>
</div>
<div class="section level4">
<h4 id="output-1">Output<a class="anchor" aria-label="anchor" href="#output-1"></a>
</h4>
<p>None yet.</p>
</div>
</div>
<div class="section level3">
<h3 id="humanbehavior">HumanBehavior<a class="anchor" aria-label="anchor" href="#humanbehavior"></a>
</h3>
<p>This is described in <code>Micro-Human.Rmd</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">HumanBehavior</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">mod</span><span class="op">)</span><span class="op">{</span>
  <span class="va">mod</span> <span class="op">=</span> <span class="fu">SpendTime</span><span class="op">(</span><span class="va">t</span>, <span class="va">mod</span><span class="op">)</span>
  <span class="va">mod</span> <span class="op">=</span> <span class="fu">Travel</span><span class="op">(</span><span class="va">t</span>, <span class="va">mod</span><span class="op">)</span> 
  <span class="va">mod</span> <span class="op">=</span> <span class="fu">Fever</span><span class="op">(</span><span class="va">t</span>, <span class="va">mod</span><span class="op">)</span>
  <span class="va">mod</span> <span class="op">=</span> <span class="fu">CareSeeking</span><span class="op">(</span><span class="va">t</span>, <span class="va">mod</span><span class="op">)</span>
  <span class="va">mod</span> <span class="op">=</span> <span class="fu">OwnITN</span><span class="op">(</span><span class="va">t</span>, <span class="va">mod</span><span class="op">)</span>
  <span class="va">mod</span> <span class="op">=</span> <span class="fu">UseITN</span><span class="op">(</span><span class="va">t</span>, <span class="va">mod</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>We have to break down things in terms of each component function.</p>
<div class="section level4">
<h4 id="spendtime">SpendTime<a class="anchor" aria-label="anchor" href="#spendtime"></a>
</h4>
<p>Dispatches on this class:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpendTime</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">mod</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"SpendTime"</span>, <span class="va">mod</span><span class="op">$</span><span class="va">host</span><span class="op">$</span><span class="va">spendtimePars</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="section level5">
<h5 id="input-2">Input<a class="anchor" aria-label="anchor" href="#input-2"></a>
</h5>
<p>Things in that class?</p>
</div>
<div class="section level5">
<h5 id="output-2">Output<a class="anchor" aria-label="anchor" href="#output-2"></a>
</h5>
<ul>
<li>
<code>Mod$TimeSpent</code>: modifies the time spent matrix</li>
</ul>
</div>
</div>
<div class="section level4">
<h4 id="travel">Travel<a class="anchor" aria-label="anchor" href="#travel"></a>
</h4>
<p>Dispatches on this class:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Travel</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">mod</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"Travel"</span>, <span class="va">mod</span><span class="op">$</span><span class="va">host</span><span class="op">$</span><span class="va">travelPars</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="section level5">
<h5 id="input-3">Input<a class="anchor" aria-label="anchor" href="#input-3"></a>
</h5>
<p>Things in that class?</p>
</div>
<div class="section level5">
<h5 id="output-3">Output<a class="anchor" aria-label="anchor" href="#output-3"></a>
</h5>
<ul>
<li>
<code>Mod$TravelAR</code>: modifies this object</li>
</ul>
</div>
</div>
<div class="section level4">
<h4 id="fever">Fever<a class="anchor" aria-label="anchor" href="#fever"></a>
</h4>
<p>Dispatches on this class:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Fever</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">mod</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"Fever"</span>, <span class="va">mod</span><span class="op">$</span><span class="va">host</span><span class="op">$</span><span class="va">feverPars</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="section level5">
<h5 id="input-4">Input<a class="anchor" aria-label="anchor" href="#input-4"></a>
</h5>
<p>Things in that class?</p>
</div>
<div class="section level5">
<h5 id="output-4">Output<a class="anchor" aria-label="anchor" href="#output-4"></a>
</h5>
<p>Things in <code>mod$host$feverPars</code>?</p>
</div>
</div>
<div class="section level4">
<h4 id="careseeking">CareSeeking<a class="anchor" aria-label="anchor" href="#careseeking"></a>
</h4>
<p>Dispatches on this class:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">CareSeeking</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">mod</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"CareSeeking"</span>, <span class="va">mod</span><span class="op">$</span><span class="va">host</span><span class="op">$</span><span class="va">careseekingPars</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="section level5">
<h5 id="input-5">Input<a class="anchor" aria-label="anchor" href="#input-5"></a>
</h5>
<p>Things in that class?</p>
</div>
<div class="section level5">
<h5 id="output-5">Output<a class="anchor" aria-label="anchor" href="#output-5"></a>
</h5>
<p>Things in <code>Mod$host$careseekingPars</code>?</p>
</div>
</div>
<div class="section level4">
<h4 id="ownitn">OwnITN<a class="anchor" aria-label="anchor" href="#ownitn"></a>
</h4>
<p>In <code>Micro-VectorControl-ITN.Rmd</code></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">OwnITN</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">mod</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"OwnITN"</span>, <span class="va">mod</span><span class="op">$</span><span class="va">vectorcontrol</span><span class="op">$</span><span class="va">itnPars</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="section level5">
<h5 id="input-6">Input<a class="anchor" aria-label="anchor" href="#input-6"></a>
</h5>
</div>
<div class="section level5">
<h5 id="output-6">Output<a class="anchor" aria-label="anchor" href="#output-6"></a>
</h5>
</div>
</div>
<div class="section level4">
<h4 id="useitn">UseITN<a class="anchor" aria-label="anchor" href="#useitn"></a>
</h4>
<p>In <code>Micro-VectorControl-ITN.Rmd</code></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">UseITN</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">mod</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"UseITN"</span>, <span class="va">mod</span><span class="op">$</span><span class="va">vectorcontrol</span><span class="op">$</span><span class="va">itnPars</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="section level5">
<h5 id="input-7">Input<a class="anchor" aria-label="anchor" href="#input-7"></a>
</h5>
</div>
<div class="section level5">
<h5 id="output-7">Output<a class="anchor" aria-label="anchor" href="#output-7"></a>
</h5>
</div>
</div>
</div>
<div class="section level3">
<h3 id="vectorcontroleffects">VectorControlEffects<a class="anchor" aria-label="anchor" href="#vectorcontroleffects"></a>
</h3>
<p>This is described in <code>Micro-VectorControl.Rmd</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">VectorControlEffects</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span><span class="op">{</span>
  <span class="va">Mod</span> <span class="op">=</span> <span class="fu">resetBaseline</span><span class="op">(</span><span class="va">Mod</span><span class="op">)</span> 
  <span class="va">Mod</span> <span class="op">=</span> <span class="fu">ITNEffects</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span>
  <span class="va">Mod</span> <span class="op">=</span> <span class="fu">IRSEffects</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span>
  <span class="va">Mod</span> <span class="op">=</span> <span class="fu">LSMEffects</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span>
  <span class="co">#Mod = ATSB(t, Mod)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">Mod</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Again, we have to break things down and look at each component function.</p>
<div class="section level4">
<h4 id="resetbaseline">resetBaseline<a class="anchor" aria-label="anchor" href="#resetbaseline"></a>
</h4>
<p>This just resets mosquito parameters to baseline prior to computing the effect from today’s vector control.</p>
<p>Found in <code>Micro-VectorControl.Rmd</code></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">resetBaseline</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">Mod</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># Defined in Micro-VectorControl.Rmd</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">Mod</span><span class="op">$</span><span class="va">nMosquito</span><span class="op">)</span><span class="op">{</span>
    <span class="va">Mod</span><span class="op">$</span><span class="va">mosquito</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">adultPars</span> <span class="op">=</span> <span class="va">Mod</span><span class="op">$</span><span class="va">mosquito</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">adultBase</span>
    <span class="va">Mod</span><span class="op">$</span><span class="va">mosquito</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">aquaPars</span> <span class="op">=</span> <span class="va">Mod</span><span class="op">$</span><span class="va">mosquito</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">aquaBase</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">Mod</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="itneffects">ITNEffects<a class="anchor" aria-label="anchor" href="#itneffects"></a>
</h4>
<p>In <code>Micro-VectorControl-ITM.Rmd</code>. Note the multiple dispatch.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ITNEffects</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">mod</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"ITNEffects"</span>, <span class="va">mod</span><span class="op">$</span><span class="va">vectorcontrol</span><span class="op">$</span><span class="va">itnPars</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="irseffects">IRSEffects<a class="anchor" aria-label="anchor" href="#irseffects"></a>
</h4>
<p>In <code>Micro-VectorControl-IRS.Rmd</code>. There’s no dispatch function yet, but there should be. There seems to be one class method, for class <code>step</code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">IRSEffects.step</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span>, <span class="va">i</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">{</span> 
  <span class="co">#############################################</span>
  <span class="co"># efficacy is modeled as a step function </span>
  <span class="co"># daily survival at the haunts is reduced by 1-IRScoverage</span>
  <span class="co"># for a number of days specified by 'duration'  </span>
  <span class="co">#############################################</span>
  <span class="va">fac</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">Mod</span><span class="op">$</span><span class="va">landscape</span><span class="op">$</span><span class="va">nHaunts</span><span class="op">)</span>
  <span class="va">ix</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">t</span><span class="op">-</span><span class="va">Mod</span><span class="op">$</span><span class="va">landscape</span><span class="op">$</span><span class="va">haunts</span><span class="op">$</span><span class="va">daySprayed</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">Mod</span><span class="op">$</span><span class="va">vectorcontrol</span><span class="op">$</span><span class="va">irsPars</span><span class="op">$</span><span class="va">duration</span> 
  <span class="va">fac</span><span class="op">[</span><span class="va">ix</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="va">Mod</span><span class="op">$</span><span class="va">landscape</span><span class="op">$</span><span class="va">haunts</span><span class="op">$</span><span class="va">IRScoverage</span><span class="op">[</span><span class="va">ix</span><span class="op">]</span>
  <span class="va">Mod</span> <span class="op">=</span> <span class="fu">adjust</span><span class="op">(</span><span class="va">fac</span>, <span class="va">Mod</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="lsmeffects">LSMEffects<a class="anchor" aria-label="anchor" href="#lsmeffects"></a>
</h4>
<p>LSM means Larval Source Management. This is in <code>Micro-VectorControl.Rmd</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">LSMEffects</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span><span class="op">{</span>
   <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"LSMEffects"</span>, <span class="va">Mod</span><span class="op">$</span><span class="va">vectorcontrol</span><span class="op">$</span><span class="va">lsmPars</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="atsb">ATSB<a class="anchor" aria-label="anchor" href="#atsb"></a>
</h4>
<p>Not implemented yet.</p>
</div>
</div>
<div class="section level3">
<h3 id="bloodfeeding">BloodFeeding<a class="anchor" aria-label="anchor" href="#bloodfeeding"></a>
</h3>
<p>This is a supremely important function. After this function executes, we are free to update the state of adult mosquitoes and human infections. It’s all stored in <code>Micro-BloodFeeding.Rmd</code>.</p>
<p>The basic dispatch is here:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">BloodFeeding</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">Mod</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"BloodFeeding"</span>, <span class="va">Mod</span><span class="op">$</span><span class="va">bloodfeedingPars</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Sean L. Wu, David L. Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
