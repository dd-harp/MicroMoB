<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="MicroMoB">
<title>Advanced topics • MicroMoB</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Advanced topics">
<meta property="og:description" content="MicroMoB">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MicroMoB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/MicroMoB.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/bloodmeal.html">Blood feeding</a>
    <a class="dropdown-item" href="../articles/RM_mosquito.html">Ross-Macdonald mosquito model</a>
    <a class="dropdown-item" href="../articles/BQ_mosquito.html">Simple behavioral state mosquito model</a>
    <a class="dropdown-item" href="../articles/MOI_human.html">Queueing model for human superinfection</a>
    <a class="dropdown-item" href="../articles/BH_aqua.html">Beverton-Holt aquatic model</a>
    <a class="dropdown-item" href="../articles/RM_transmission.html">Ross-Macdonald transmission model</a>
    <a class="dropdown-item" href="../articles/Advanced.html">Advanced topics</a>
    <a class="dropdown-item" href="../articles/Contributing.html">Contributing</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dd-harp/MicroMoB/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Advanced topics</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dd-harp/MicroMoB/blob/HEAD/vignettes/Advanced.Rmd" class="external-link"><code>vignettes/Advanced.Rmd</code></a></small>
      <div class="d-none name"><code>Advanced.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dd-harp.github.io/MicroMoB/">MicroMoB</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="writing-new-packages">Writing new packages<a class="anchor" aria-label="anchor" href="#writing-new-packages"></a>
</h2>
<p>Often the base way to extend <strong>Micro-MoB</strong> will be to write a new package that depends on it and which implements specific new models as needed, and depends on the bits of core computation provided by <strong>Micro-MoB</strong>.</p>
<p>The steps for writing a new package that depends on <strong>Micro-MoB</strong> are:</p>
<ol style="list-style-type: decimal">
<li>Add <code>MicroMoB</code> to the <code>Imports:</code> list of your package’s DESCRIPTION</li>
<li>If you want to depend on the latest version of <strong>Micro-MoB</strong>, rather than CRAN, add <code>dd-harp/MicroMoB</code> to the <code>Remotes:</code> list of DESCRIPTION</li>
<li>To use methods from <strong>Micro-MoB</strong> we recommend importing using roxygen2 tags, for example <code>@importFrom MicroMoB compute_q</code> to import the generic method <code>compute_q</code>, rather than using the <code>::</code> operator in every instance. Please note you only need to import the generic, and not the class-specific methods, as R’s namespace lookup will find the right function for you.</li>
</ol>
<p>To see an example of an extension package, please take a look at <a href="https://github.com/dd-harp/MicroWNV" class="external-link">MicroWNV</a>, which adds a new host component, birds, for modeling of West Nile virus.</p>
</div>
<div class="section level2">
<h2 id="writing-new-models">Writing new models<a class="anchor" aria-label="anchor" href="#writing-new-models"></a>
</h2>
<p>To write a model for a component means that one must write methods that fulfill each component’s interface, and ensure that those methods return the correct data structure. Information on the methods can be found in the function reference under each component. In addition, a new model must have a setup function, which takes in parameters, does argument checking, and attaches a new object with the correct name and class attached to the model object returned from <code><a href="../reference/make_MicroMoB.html">make_MicroMoB()</a></code>.</p>
<p>For example, to make a new mosquito model, with class <code>MyModel</code>, one would need to do the following:</p>
<ol style="list-style-type: decimal">
<li>Write a function <code>setup_mosquito_MyModel</code> which attaches an object (usually a list) to the model environment with the <code>class</code> attribute assigned to <code>"MyModel"</code>.</li>
<li>Write methods for the interface <code>compute_f.MyModel</code>, <code>compute_q.MyModel</code>, <code>compute_Z.MyModel</code>, and <code>compute_oviposit.MyModel</code>. Information on what each method is expected to compute and return can be found <a href="https://dd-harp.github.io/MicroMoB/reference/index.html#adult-mosquito-component">here</a>.</li>
<li>Write a step (updating) function, <code>step_mosquitoes.MyModel</code>. One can optionally allow the <code>class</code> attribute of the model list to have 2 elements to allow for dispatching on stochastic or deterministic step updates, in which case one would additionally write <code>step_mosquitoes.MyModel_stochastic</code> and <code>step_mosquitoes.MyModel_deterministic</code>. Please look at the <a href="https://github.com/dd-harp/MicroMoB/blob/HEAD/R/mosquito_RM.R" class="external-link">source code</a> of the Ross-Macdonald mosquito model to see how to do this.</li>
<li>Write basic tests for your model, which go in <code>tests/testthat</code>. At a minimum, your tests should confirm that the model can be set up properly and produces correct results when updated over a time step.</li>
</ol>
</div>
<div class="section level2">
<h2 id="plumber-web-api">Plumber web API<a class="anchor" aria-label="anchor" href="#plumber-web-api"></a>
</h2>
<p><strong>Micro-MoB</strong> includes some limited support for configuring and running models via web API, using the <a href="https://www.rplumber.io/" class="external-link">Plumber package</a>.</p>
<p>All APIs are stored in <code>inst/plumber/APINAME/plumber.R</code>, where <code>APINAME</code> is the name of the specific API.</p>
<p>A simple API can be started up from within R by running the following code:</p>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dd-harp.github.io/MicroMoB/">MicroMoB</a></span><span class="op">)</span></span>
<span><span class="fu">plumb_api</span><span class="op">(</span>package <span class="op">=</span> <span class="st">"MicroMoB"</span>, name <span class="op">=</span> <span class="st">"mosquito"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pr_run</span><span class="op">(</span><span class="op">)</span></span></code></pre>
<p>The web APIs use JSON files to configure the model, please see the <code>get_config_COMPONENT_MODEL</code> function documentation for how those files should be specified. The web API functionality is highly unstable so please be aware there may be large changes from version to version.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Sean L. Wu, David L. Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
