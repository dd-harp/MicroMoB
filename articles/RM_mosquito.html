<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="MicroMoB">
<title>Ross-Macdonald mosquito model • MicroMoB</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Ross-Macdonald mosquito model">
<meta property="og:description" content="MicroMoB">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MicroMoB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/MicroMoB.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/BH_aqua.html">Beverton-Holt aquatic model</a>
    <a class="dropdown-item" href="../articles/Contributing.html">Contributing</a>
    <a class="dropdown-item" href="../articles/MOI_human.html">Queueing model for human superinfection</a>
    <a class="dropdown-item" href="../articles/RM_mosquito.html">Ross-Macdonald mosquito model</a>
    <a class="dropdown-item" href="../articles/RM_transmission.html">Ross-Macdonald transmission model</a>
    <a class="dropdown-item" href="../articles/bloodmeal.html">Blood feeding</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dd-harp/MicroMoB/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">

<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Ross-Macdonald mosquito model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dd-harp/MicroMoB/blob/HEAD/vignettes/RM_mosquito.Rmd" class="external-link"><code>vignettes/RM_mosquito.Rmd</code></a></small>
      <div class="d-none name"><code>RM_mosquito.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dd-harp/MicroMoB" class="external-link">MicroMoB</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></code></pre></div>
<p>One of the mainstays of mosquito-borne pathogen transmission modeling is the Ross-Macdonald (RM) model and its various elaborations. The various models referred to as the RM model are generically a set of mathematical models, in continuous or discrete time, which consider mosquitoes to take bloodmeals on hosts at some constant rate, experience a latent period between infection and infectiousness (the extrinsic incubation period, EIP), and experience a constant rate of mortality.</p>
<p>In MicroMoB we include a generalized RM model which can fill the interface for the mosquito component. The generalized RM model has both a stochastic and deterministic option for updating state over a time step, which is a daily step.</p>
<p>The model requires the following parameters:</p>
<ul>
<li>
<code>a</code>: the host blood feeding rate</li>
<li>
<code>p</code>: daily survival probability (may be time-varying)</li>
<li>
<code>EIP</code>: duration of incubation period (may be time-varying, <code>EIP[t]</code> gives the number of days mosquitoes infected on day <code>t</code> must wait before becoming infectious)</li>
<li>
<code>psi</code>: dispersal matrix describing movement between places</li>
</ul>
<p>The state of the model is stored in vectors of length <code>p</code> (number of places/patches):</p>
<ul>
<li>
<code>M</code>: total mosquito density</li>
<li>
<code>Y</code>: density of infected mosquitoes</li>
<li>
<code>Z</code>: density of infectious mosquitoes</li>
</ul>
<p>Note that the number of uninfected mosquitoes is <code>M - Y</code> and the number of infected but not yet infectious (incubating) mosquitoes is <code>Y - Z</code>.</p>
<div class="section level2">
<h2 id="deterministic-model">Deterministic model<a class="anchor" aria-label="anchor" href="#deterministic-model"></a>
</h2>
<p>The deterministic model has the following form:</p>
<p><span class="math display">\[\begin{equation}
Y_{0} = a \kappa_{t} (M_{t} - Y_{t})  \\
M_{t+1} = (pM_{t}) \cdot \psi +\lambda_{t} \\
Y_{t+1} = p(Y_{t} + Y_{0}) \cdot \psi \\
Z_{t+1} = (pZ_{t} \cdot \psi) + (a \kappa_{t-EIP} (M_{t-EIP} - Y_{t-EIP}) p^{EIP} \cdot \psi^{EIP})
\end{equation}\]</span></p>
<p>With the minor difference that in the code, the EIP is forward-looking rather than backwards. We also note that <span class="math inline">\(p\)</span> is allowed to be time-varying, even though here we have represented it as a constant. <span class="math inline">\(\kappa\)</span> is passed to the mosquito component every day as a parameter, and is the net infectiousness of all hosts to mosquitoes (the probability a mosquito would become infected after biting a random blood host).</p>
<p><span class="math inline">\(\lambda_{t}\)</span> is the number of newly emerging adults on that day. It is calculated in the aquatic (immature) component and passed to the mosquito component as a parameter.</p>
</div>
<div class="section level2">
<h2 id="stochastic-model">Stochastic model<a class="anchor" aria-label="anchor" href="#stochastic-model"></a>
</h2>
<p>The stochastic model is as the deterministic one but all survival probabilities are used in binomial draws (or hypergeometric draws for nested sampling), and <span class="math inline">\(\psi\)</span> parameterizes a multinomial draw over destination places/patches for mosquitoes leaving their home place. The stochastic model has been designed with care and appropriately tested to make sure that it does not draw inconsistent event histories for mosquitoes (e.g. sampling survival twice for mosquitoes in the same compartment).</p>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>Let’s do an example. We’ll need to set up both the aquatic and mosquito components. The example will run for three years. We will make <span class="math inline">\(\lambda\)</span> a vector giving emergence for each patch, for each day of the year, peaking in the middle of the year with 100 mosquitoes emerging per day, per patch.</p>
<p>We also assume that daily survival <code>p</code> is sinsuoidal, with a period of 365 days.</p>
<p>We let the EIP be a constant 5 days. We will also set <span class="math inline">\(\kappa = 0.05\)</span> for each day.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tmax</span> <span class="op">&lt;-</span> <span class="fl">365</span> <span class="op">*</span> <span class="fl">3</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">3</span>

<span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, mean <span class="op">=</span> <span class="fl">180</span>, sd <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>
<span class="va">lambda</span> <span class="op">&lt;-</span> <span class="va">lambda</span> <span class="op">*</span> <span class="op">(</span><span class="fl">100</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span>
<span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">lambda</span><span class="op">)</span><span class="op">)</span>

<span class="va">psurv</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span><span class="op">)</span><span class="op">/</span><span class="fl">365</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1.01</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span> <span class="op">*</span> <span class="fl">0.9</span>

<span class="va">EIP</span> <span class="op">&lt;-</span> <span class="fl">5</span>

<span class="va">f</span> <span class="op">&lt;-</span> <span class="fl">0.3</span>
<span class="va">q</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">psi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>
    <span class="fl">0.9</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>,
    <span class="fl">0.05</span>, <span class="fl">0.9</span>, <span class="fl">0.05</span>,
    <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.9</span>
  <span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">3</span>, 
  byrow <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>


<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">2</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"red"</span>, xlab <span class="op">=</span> <span class="st">"Day"</span>, ylab <span class="op">=</span> <span class="st">"Lambda (red)"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>new <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">psurv</span>, type <span class="op">=</span> <span class="st">"l"</span>, axes <span class="op">=</span> <span class="cn">F</span>, xlab <span class="op">=</span> <span class="cn">NA</span>, ylab <span class="op">=</span> <span class="cn">NA</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">4</span>, line <span class="op">=</span> <span class="fl">3</span>, <span class="st">'Survival Probability (blue)'</span><span class="op">)</span></code></pre></div>
<p><img src="RM_mosquito_files/figure-html/unnamed-chunk-2-1.png" width="768"></p>
<div class="section level3">
<h3 id="deterministic-simulation">Deterministic simulation<a class="anchor" aria-label="anchor" href="#deterministic-simulation"></a>
</h3>
<p>Now we can set up the models. Let’s first do a deterministic simulation. We use <code>setup_mosquito_RM</code> to setup the RM mosquito model for the mosquito component, and <code>setup_aqua_trace</code> to set up the aquatic (immature) component as a simple trace (forced) model.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span>, <span class="fl">100</span><span class="op">)</span>
<span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>
<span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>

<span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_MicroMoB.html">make_MicroMoB</a></span><span class="op">(</span>tmax <span class="op">=</span> <span class="va">tmax</span>, p <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="fu"><a href="../reference/setup_mosquito_RM.html">setup_mosquito_RM</a></span><span class="op">(</span><span class="va">mod</span>, stochastic <span class="op">=</span> <span class="cn">FALSE</span>, f <span class="op">=</span> <span class="va">f</span>, q <span class="op">=</span> <span class="va">q</span>, eip <span class="op">=</span> <span class="va">EIP</span>, p <span class="op">=</span> <span class="va">psurv</span>, psi <span class="op">=</span> <span class="va">psi</span>, M <span class="op">=</span> <span class="va">M</span>, Y <span class="op">=</span> <span class="va">Y</span>, Z <span class="op">=</span> <span class="va">Z</span><span class="op">)</span>
<span class="fu"><a href="../reference/setup_aqua_trace.html">setup_aqua_trace</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span>, lambda <span class="op">=</span> <span class="va">lambda</span>, stochastic <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">M_det</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">tmax</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">Y_det</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">tmax</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">Z_det</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">tmax</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>

<span class="co"># run it</span>
<span class="kw">while</span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">global</span><span class="op">$</span><span class="va">tnow</span> <span class="op">&lt;=</span> <span class="va">tmax</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">mod</span><span class="op">$</span><span class="va">mosquito</span><span class="op">$</span><span class="va">kappa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="fu"><a href="../reference/step_aqua.html">step_aqua</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span><span class="op">)</span>
  <span class="fu"><a href="../reference/step_mosquitoes.html">step_mosquitoes</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span><span class="op">)</span>
  <span class="va">M_det</span><span class="op">[</span><span class="va">mod</span><span class="op">$</span><span class="va">global</span><span class="op">$</span><span class="va">tnow</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="va">mosquito</span><span class="op">$</span><span class="va">M</span>
  <span class="va">Y_det</span><span class="op">[</span><span class="va">mod</span><span class="op">$</span><span class="va">global</span><span class="op">$</span><span class="va">tnow</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="va">mosquito</span><span class="op">$</span><span class="va">Y</span>
  <span class="va">Z_det</span><span class="op">[</span><span class="va">mod</span><span class="op">$</span><span class="va">global</span><span class="op">$</span><span class="va">tnow</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="va">mosquito</span><span class="op">$</span><span class="va">Z</span>
  <span class="va">mod</span><span class="op">$</span><span class="va">global</span><span class="op">$</span><span class="va">tnow</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="va">global</span><span class="op">$</span><span class="va">tnow</span> <span class="op">+</span> <span class="fl">1L</span>
<span class="op">}</span>

<span class="va">det_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">M_det</span>, <span class="va">Y_det</span>, <span class="va">Z_det</span><span class="op">)</span><span class="op">)</span>

<span class="va">det_out</span><span class="op">[</span>, <span class="st">"Day"</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">tmax</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
<span class="va">det_out</span><span class="op">[</span>, <span class="st">"Compartment"</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="st">"Y"</span>, <span class="st">"Z"</span><span class="op">)</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">tmax</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
<span class="va">det_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/melt.data.table.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">det_out</span>, id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Day"</span>, <span class="st">"Compartment"</span><span class="op">)</span>, variable.name <span class="op">=</span> <span class="st">"Patch"</span>, value.name <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span>
<span class="va">det_out</span><span class="op">[</span>, <span class="st">"Patch"</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">Patch</span><span class="op">)</span><span class="op">]</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">det_out</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Day</span>, y <span class="op">=</span> <span class="va">Count</span>, color <span class="op">=</span> <span class="va">Compartment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">Patch</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span></code></pre></div>
<p><img src="RM_mosquito_files/figure-html/unnamed-chunk-3-1.png" width="960"></p>
</div>
<div class="section level3">
<h3 id="stochastic-simulation">Stochastic simulation<a class="anchor" aria-label="anchor" href="#stochastic-simulation"></a>
</h3>
<p>Now we run 10 stochastic simulations, using the same parameters.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sto_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">mclapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">runid</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_MicroMoB.html">make_MicroMoB</a></span><span class="op">(</span>tmax <span class="op">=</span> <span class="va">tmax</span>, p <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
  <span class="fu"><a href="../reference/setup_mosquito_RM.html">setup_mosquito_RM</a></span><span class="op">(</span><span class="va">mod</span>, stochastic <span class="op">=</span> <span class="cn">TRUE</span>, f <span class="op">=</span> <span class="va">f</span>, q <span class="op">=</span> <span class="va">q</span>, eip <span class="op">=</span> <span class="va">EIP</span>, p <span class="op">=</span> <span class="va">psurv</span>, psi <span class="op">=</span> <span class="va">psi</span>, M <span class="op">=</span> <span class="va">M</span>, Y <span class="op">=</span> <span class="va">Y</span>, Z <span class="op">=</span> <span class="va">Z</span><span class="op">)</span>
  <span class="fu"><a href="../reference/setup_aqua_trace.html">setup_aqua_trace</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span>, lambda <span class="op">=</span> <span class="va">lambda</span>, stochastic <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  
  <span class="va">M_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">tmax</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>
  <span class="va">Y_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">tmax</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>
  <span class="va">Z_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">tmax</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co"># run it</span>
  <span class="kw">while</span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">global</span><span class="op">$</span><span class="va">tnow</span> <span class="op">&lt;=</span> <span class="va">tmax</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">mod</span><span class="op">$</span><span class="va">mosquito</span><span class="op">$</span><span class="va">kappa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">3</span><span class="op">)</span>
    <span class="fu"><a href="../reference/step_aqua.html">step_aqua</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span><span class="op">)</span>
    <span class="fu"><a href="../reference/step_mosquitoes.html">step_mosquitoes</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span><span class="op">)</span>
    <span class="va">M_out</span><span class="op">[</span><span class="va">mod</span><span class="op">$</span><span class="va">global</span><span class="op">$</span><span class="va">tnow</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="va">mosquito</span><span class="op">$</span><span class="va">M</span>
    <span class="va">Y_out</span><span class="op">[</span><span class="va">mod</span><span class="op">$</span><span class="va">global</span><span class="op">$</span><span class="va">tnow</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="va">mosquito</span><span class="op">$</span><span class="va">Y</span>
    <span class="va">Z_out</span><span class="op">[</span><span class="va">mod</span><span class="op">$</span><span class="va">global</span><span class="op">$</span><span class="va">tnow</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="va">mosquito</span><span class="op">$</span><span class="va">Z</span>
    <span class="va">mod</span><span class="op">$</span><span class="va">global</span><span class="op">$</span><span class="va">tnow</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="va">global</span><span class="op">$</span><span class="va">tnow</span> <span class="op">+</span> <span class="fl">1L</span>
  <span class="op">}</span>
  
  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">M_out</span>, <span class="va">Y_out</span>, <span class="va">Z_out</span><span class="op">)</span><span class="op">)</span>
  <span class="va">out</span><span class="op">[</span>, <span class="st">"Day"</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">tmax</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="va">out</span><span class="op">[</span>, <span class="st">"Compartment"</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="st">"Y"</span>, <span class="st">"Z"</span><span class="op">)</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">tmax</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/melt.data.table.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">out</span>, id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Day"</span>, <span class="st">"Compartment"</span><span class="op">)</span>, variable.name <span class="op">=</span> <span class="st">"Patch"</span>, value.name <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span>
  <span class="va">out</span><span class="op">[</span>, <span class="st">"Patch"</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">Patch</span><span class="op">)</span><span class="op">]</span>
  <span class="va">out</span><span class="op">[</span>, <span class="st">"Run"</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">runid</span><span class="op">)</span><span class="op">]</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="va">sto_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">sto_out</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sto_out</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Day</span>, y <span class="op">=</span> <span class="va">Count</span>, color <span class="op">=</span> <span class="va">Compartment</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">Run</span>, <span class="va">Compartment</span><span class="op">)</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.35</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">Patch</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span></code></pre></div>
<p><img src="RM_mosquito_files/figure-html/unnamed-chunk-4-1.png" width="960"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Sean L. Wu, David L. Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
