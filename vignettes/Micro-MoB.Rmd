---
title: "Micro-MoB"
output:
  rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Micro-MoB}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(MicroMoB)
```

In old MicroMoB $\Psi$ was TaR.
In old MicroMoB $W$ was SiG (but it seems to be a matrix in the old one).
In old MicroMoB $\kappa$ was NI.
In old MicroMoB $\beta$ was DiB.

## Spatial Dynamics and Micro-MoB papers comparison and walkthrough

### Human population strata

In Spatial Dynamics we have:

\begin{equation}
P = J \cdot H
\end{equation}

In this software we assume a user provides `J`, `H` when making the human object
in `setup.human`. If working with complex strata, the helper function `strata_to_residency`
can generate a suitable `J` matrix.

There are $p$ patches and $n$ strata. In general, $n \geq p$ because there may be
multiple strata with the same patch residency (e.g. young, middle-aged, old). If
$n > p$ then the number of demographic strata summing over patches is $s = n/p$.

We will call $s$ demographic strata, and $n$ strata. If there are 2 demographic
strata and 3 patches, n = 6.

The dimensions are as follows:

  * $P_{p\times 1}$: vector of human populations at each patch (all strata)
  * $J_{p\times n}$: residency matrix mapping strata to patch
  * $H_{n\times 1}$: vector of human populations (strata)
  
### Human mobility time spent

The time spent matrix fulfills the following constraint:

\begin{equation}
\sum_j \Theta_{i,j} \leq 1
\end{equation}

The time spent matrix has dimension $\Theta_{n\times p}$.

The software uses `setup.timespent` to assign $\Theta$ to the model object. It
can either be a single matrix or a list of matrices if modeling fractions of a day.

### Ambient populations

### Time at risk

In Spatial dynamics we have:

$$
\int_{0}^1 \xi(s) ds=1
$$
$\Xi$ is normalized to 1, so it is a probability density. It gives the probability
of the time of day a mosquito initiates a blood feeding attempt (including search),
_conditional_ on the mosquito attempting to blood feed that day.

In the software, if the smallest fraction of time modeled is a day, it is vaculously
equal to 1, because it says, if a mosquito attempts to blood feed today, then with
probability 1, they start the attempt today. Otherwise, `Xi` will be a vector
that sums to 1, giving the probability of each block.

The time at risk (TaR) matrix, $\Psi$ is then:

$$
\Psi(t) = \Theta(t) \xi(t)
$$

In the software, `compute_Psi.timespent` computes $\Psi^{T}$ and dispatches based
on a daily or sub-daily model of time spent. Because it is a scalar times `Theta`,
it has dimensions $\Psi_{n\times p}$.

### Human availability

Human availability is a vector-centric concept. It is something akin to giving
the expectation number of persons available to be bitten at each patch, but
the additional multiplication by $\Xi$ means it is weighted by the probability 
of a mosquito to initiate the search at that time $t$.

$$
W(t) = \Psi(t)^T \cdot w_f H
$$
The vector has dimension $W_{p\times 1}$.
